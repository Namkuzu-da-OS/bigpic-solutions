<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rocket Lab (RKLB) — Flight Profile</title>
<meta name="description" content="An interactive investment thesis for Rocket Lab USA, Inc. (RKLB) — from launchpad to orbit.">
<meta property="og:title" content="Rocket Lab (RKLB) — Flight Profile">
<meta property="og:description" content="An interactive investment thesis for Rocket Lab USA, Inc. (RKLB) — from launchpad to orbit.">
<meta property="og:image" content="https://markets.bigpicsolutions.com/research/supplementary/RocketLab/rklb-thumb.jpg">
<meta property="og:url" content="https://markets.bigpicsolutions.com/research/supplementary/RocketLab/RKLB-Flight-Profile.html">
<meta property="og:type" content="article">
<meta property="og:site_name" content="BigPic Solutions Research">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Rocket Lab (RKLB) — Flight Profile">
<meta name="twitter:description" content="An interactive investment thesis for Rocket Lab USA, Inc. (RKLB) — from launchpad to orbit.">
<meta name="twitter:image" content="https://markets.bigpicsolutions.com/research/supplementary/RocketLab/rklb-thumb.jpg">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
<style>
/* ═══════════════════════════════════════════════════════════
   CSS CUSTOM PROPERTIES
   ═══════════════════════════════════════════════════════════ */
:root {
  --bg-deep: #050a12;
  --bg-navy: #0a1628;
  --bg-card: rgba(10, 22, 40, 0.85);
  --bg-card-hover: rgba(15, 30, 55, 0.92);
  --bg-glass: rgba(255,255,255,0.03);
  --border-subtle: rgba(255,255,255,0.06);
  --border-glow: rgba(0, 200, 255, 0.15);
  --text-primary: #e8ecf4;
  --text-secondary: #8a94a8;
  --text-muted: #505a6e;
  --accent-cyan: #00d4ff;
  --accent-blue: #4d9fff;
  --accent-amber: #f59e0b;
  --accent-green: #10b981;
  --accent-coral: #f43f5e;
  --accent-violet: #8b5cf6;
  --glow-cyan: 0 0 30px rgba(0, 212, 255, 0.15);
  --glow-green: 0 0 20px rgba(16, 185, 129, 0.12);
  --radius: 12px;
  --radius-lg: 20px;
  --font-display: 'Space Grotesk', sans-serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ═══════════════════════════════════════════════════════════
   RESET & BASE
   ═══════════════════════════════════════════════════════════ */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; scrollbar-width: thin; scrollbar-color: var(--accent-cyan) var(--bg-deep); }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-deep); }
::-webkit-scrollbar-thumb { background: var(--accent-cyan); border-radius: 3px; }

body {
  font-family: var(--font-body);
  background: linear-gradient(180deg, var(--bg-navy) 0%, var(--bg-deep) 30%, #020408 100%);
  color: var(--text-primary);
  line-height: 1.7;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* ═══════════════════════════════════════════════════════════
   STARFIELD
   ═══════════════════════════════════════════════════════════ */
canvas#starfield {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 0;
  pointer-events: none;
}

/* ═══════════════════════════════════════════════════════════
   LAYOUT
   ═══════════════════════════════════════════════════════════ */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 24px;
  position: relative;
  z-index: 1;
}

section {
  padding: 100px 0;
  position: relative;
}

/* ═══════════════════════════════════════════════════════════
   NAVIGATION
   ═══════════════════════════════════════════════════════════ */
.nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  background: rgba(5, 10, 18, 0.85);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-subtle);
  transform: translateY(-100%);
  transition: transform 0.4s ease;
}
.nav.visible { transform: translateY(0); }
.nav-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  align-items: center;
  height: 52px;
  gap: 8px;
  overflow-x: auto;
}
.nav-brand {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 15px;
  color: var(--accent-cyan);
  white-space: nowrap;
  margin-right: 16px;
  letter-spacing: -0.3px;
}
.nav-link {
  font-size: 12px;
  font-weight: 500;
  color: var(--text-muted);
  text-decoration: none;
  padding: 6px 12px;
  border-radius: 6px;
  white-space: nowrap;
  transition: var(--transition);
  letter-spacing: 0.3px;
  text-transform: uppercase;
}
.nav-link:hover { color: var(--text-secondary); background: var(--bg-glass); }
.nav-link.active { color: var(--accent-cyan); background: rgba(0, 212, 255, 0.08); }

/* ═══════════════════════════════════════════════════════════
   SCROLL PROGRESS INDICATOR
   ═══════════════════════════════════════════════════════════ */
.progress-track {
  position: fixed;
  left: 24px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 90;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}
.progress-line {
  width: 2px;
  height: 200px;
  background: rgba(255,255,255,0.06);
  border-radius: 1px;
  position: relative;
}
.progress-fill {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(180deg, var(--accent-cyan), var(--accent-violet));
  border-radius: 1px;
  transition: height 0.1s linear;
}
.progress-rocket {
  font-size: 18px;
  filter: drop-shadow(0 0 6px rgba(0, 212, 255, 0.4));
  transition: transform 0.1s linear;
}
.progress-altitude {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-muted);
  margin-top: 4px;
  white-space: nowrap;
}

/* ═══════════════════════════════════════════════════════════
   HERO
   ═══════════════════════════════════════════════════════════ */
.hero {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 80px 24px;
}
.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 18px;
  background: rgba(0, 212, 255, 0.06);
  border: 1px solid rgba(0, 212, 255, 0.2);
  border-radius: 100px;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--accent-cyan);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 32px;
  animation: fadeInDown 0.8s ease-out;
}
.hero-badge::before {
  content: '';
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent-cyan);
  animation: pulse-dot 2s infinite;
}
@keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
@keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

.hero h1 {
  font-family: var(--font-display);
  font-size: clamp(48px, 8vw, 96px);
  font-weight: 700;
  letter-spacing: -2px;
  line-height: 1;
  margin-bottom: 16px;
  background: linear-gradient(135deg, #ffffff 0%, var(--accent-cyan) 50%, var(--accent-violet) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: fadeInUp 1s ease-out 0.2s both;
}
.hero-subtitle {
  font-size: clamp(16px, 2.5vw, 22px);
  color: var(--text-secondary);
  max-width: 600px;
  margin-bottom: 48px;
  animation: fadeInUp 1s ease-out 0.4s both;
  font-weight: 300;
}
.hero-thesis {
  font-family: var(--font-mono);
  font-size: 13px;
  color: var(--accent-amber);
  padding: 10px 20px;
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: 8px;
  background: rgba(245, 158, 11, 0.04);
  margin-bottom: 56px;
  animation: fadeInUp 1s ease-out 0.5s both;
  max-width: 700px;
}

/* ═══════════════════════════════════════════════════════════
   STAT CARDS (TELEMETRY)
   ═══════════════════════════════════════════════════════════ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  max-width: 700px;
  width: 100%;
  animation: fadeInUp 1s ease-out 0.6s both;
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: var(--transition);
}
.stat-card:hover {
  background: var(--bg-card-hover);
  border-color: var(--border-glow);
  box-shadow: var(--glow-cyan);
}
.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 20%; right: 20%;
  height: 2px;
  border-radius: 0 0 2px 2px;
}
.stat-card.cyan::before { background: var(--accent-cyan); }
.stat-card.green::before { background: var(--accent-green); }
.stat-card.amber::before { background: var(--accent-amber); }
.stat-card.violet::before { background: var(--accent-violet); }
.stat-value {
  font-family: var(--font-mono);
  font-size: 28px;
  font-weight: 600;
  letter-spacing: -1px;
  margin-bottom: 4px;
}
.stat-card.cyan .stat-value { color: var(--accent-cyan); }
.stat-card.green .stat-value { color: var(--accent-green); }
.stat-card.amber .stat-value { color: var(--accent-amber); }
.stat-card.violet .stat-value { color: var(--accent-violet); }
.stat-label {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 500;
}

/* ═══════════════════════════════════════════════════════════
   MILESTONE MARKERS
   ═══════════════════════════════════════════════════════════ */
.milestone {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  padding: 40px 24px;
  opacity: 0;
}
.milestone.visible { opacity: 1; transition: opacity 0.6s ease; }
.milestone-line {
  flex: 1;
  max-width: 200px;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.3), transparent);
}
.milestone-label {
  font-family: var(--font-mono);
  font-size: 13px;
  font-weight: 600;
  color: var(--accent-cyan);
  letter-spacing: 3px;
  text-transform: uppercase;
  white-space: nowrap;
  text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
}

/* ═══════════════════════════════════════════════════════════
   SECTION HEADERS
   ═══════════════════════════════════════════════════════════ */
.section-phase {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-cyan);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 8px;
  opacity: 0.7;
}
.section-title {
  font-family: var(--font-display);
  font-size: clamp(28px, 4vw, 42px);
  font-weight: 700;
  letter-spacing: -1px;
  margin-bottom: 12px;
  color: var(--text-primary);
}
.section-desc {
  font-size: 16px;
  color: var(--text-secondary);
  max-width: 650px;
  margin-bottom: 48px;
  line-height: 1.7;
}

/* ═══════════════════════════════════════════════════════════
   CAPCOM CALLOUTS
   ═══════════════════════════════════════════════════════════ */
.capcom {
  background: rgba(0, 212, 255, 0.04);
  border-left: 3px solid var(--accent-cyan);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 20px 24px;
  margin: 40px 0;
  position: relative;
}
.capcom-label {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--accent-cyan);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 8px;
  opacity: 0.7;
}
.capcom-text {
  font-size: 15px;
  color: var(--text-primary);
  font-weight: 400;
  line-height: 1.7;
}

/* ═══════════════════════════════════════════════════════════
   CHART CONTAINERS
   ═══════════════════════════════════════════════════════════ */
.chart-wrap {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 32px;
  margin-bottom: 32px;
  position: relative;
  overflow: hidden;
}
.chart-wrap:hover { border-color: var(--border-glow); }
.chart-title {
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 4px;
}
.chart-subtitle {
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 24px;
}
.chart-container { width: 100%; position: relative; }
.chart-container svg {
  width: 100%;
  height: auto;
  display: block;
  overflow: visible;
}

/* ═══════════════════════════════════════════════════════════
   DATA CARDS & GRIDS
   ═══════════════════════════════════════════════════════════ */
.card-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-bottom: 32px;
}
.data-card {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  padding: 24px;
  transition: var(--transition);
}
.data-card:hover {
  border-color: var(--border-glow);
  box-shadow: var(--glow-cyan);
}
.data-card-label {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.data-card-value {
  font-family: var(--font-mono);
  font-size: 32px;
  font-weight: 600;
  letter-spacing: -1px;
}
.data-card-detail {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 8px;
  line-height: 1.5;
}

/* ═══════════════════════════════════════════════════════════
   COUNTER RING
   ═══════════════════════════════════════════════════════════ */
.counter-ring {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin: 32px 0;
}
.counter-ring svg { filter: drop-shadow(0 0 12px rgba(16, 185, 129, 0.2)); }
.counter-number {
  font-family: var(--font-mono);
  font-size: 48px;
  font-weight: 700;
  color: var(--accent-green);
}
.counter-label {
  font-size: 14px;
  color: var(--text-secondary);
  text-align: center;
}

/* ═══════════════════════════════════════════════════════════
   TOGGLE SWITCH
   ═══════════════════════════════════════════════════════════ */
.toggle-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.toggle-option {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-muted);
  cursor: pointer;
  transition: var(--transition);
  letter-spacing: 0.5px;
}
.toggle-option.active { color: var(--accent-cyan); }
.toggle-track {
  width: 40px; height: 22px;
  background: rgba(255,255,255,0.08);
  border-radius: 11px;
  cursor: pointer;
  position: relative;
  transition: var(--transition);
}
.toggle-thumb {
  width: 18px; height: 18px;
  background: var(--accent-cyan);
  border-radius: 50%;
  position: absolute;
  top: 2px; left: 2px;
  transition: var(--transition);
  box-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
}
.toggle-track.on .toggle-thumb { left: 20px; }

/* ═══════════════════════════════════════════════════════════
   EXPANDABLE CARDS
   ═══════════════════════════════════════════════════════════ */
.expand-card {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 16px;
}
.expand-header {
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: var(--transition);
}
.expand-header:hover { background: var(--bg-glass); }
.expand-title {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
}
.expand-icon {
  font-family: var(--font-mono);
  font-size: 18px;
  color: var(--text-muted);
  transition: transform 0.3s ease;
}
.expand-card.open .expand-icon { transform: rotate(45deg); }
.expand-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.expand-content { padding: 0 20px 20px; }

/* ═══════════════════════════════════════════════════════════
   COMPARISON TABLE
   ═══════════════════════════════════════════════════════════ */
.comp-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}
.comp-table th {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: left;
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-subtle);
  font-weight: 500;
}
.comp-table td {
  padding: 12px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  color: var(--text-secondary);
}
.comp-table tr:hover td { background: var(--bg-glass); }
.comp-table .highlight td {
  color: var(--accent-cyan);
  font-weight: 500;
}
.comp-table .mono {
  font-family: var(--font-mono);
  font-size: 13px;
}

/* ═══════════════════════════════════════════════════════════
   SDA CONTRACT CARDS
   ═══════════════════════════════════════════════════════════ */
.contract-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-bottom: 24px;
}
.contract-card {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-lg);
  padding: 28px;
  position: relative;
  overflow: hidden;
}
.contract-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-cyan), var(--accent-violet));
}
.contract-name {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-cyan);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 12px;
}
.contract-value {
  font-family: var(--font-mono);
  font-size: 36px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -1px;
}
.contract-detail {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 12px;
  line-height: 1.6;
}
.contract-total {
  background: linear-gradient(135deg, rgba(0, 212, 255, 0.08), rgba(139, 92, 246, 0.08));
  border: 1px solid rgba(0, 212, 255, 0.2);
  border-radius: var(--radius-lg);
  padding: 24px;
  text-align: center;
  margin-bottom: 40px;
}
.contract-total-label {
  font-size: 12px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 4px;
}
.contract-total-value {
  font-family: var(--font-mono);
  font-size: 48px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-violet));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ═══════════════════════════════════════════════════════════
   INTEGRATION STACK (SATELLITE SVG)
   ═══════════════════════════════════════════════════════════ */
.integration-container {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 40px;
  align-items: start;
  margin: 40px 0;
}
.integration-svg { width: 100%; }
.integration-legend { display: flex; flex-direction: column; gap: 8px; }
.integration-item {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  transition: var(--transition);
  border: 1px solid transparent;
}
.integration-item:hover, .integration-item.active {
  background: var(--bg-card);
  border-color: var(--border-glow);
}
.integration-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}
.integration-name { font-size: 13px; font-weight: 500; color: var(--text-primary); }
.integration-detail { font-size: 11px; color: var(--text-muted); }
.integration-price {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-cyan);
  margin-left: auto;
}

/* ═══════════════════════════════════════════════════════════
   NEUTRON COMPARISON
   ═══════════════════════════════════════════════════════════ */
.neutron-comp {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--border-subtle);
  margin: 32px 0;
}
.neutron-col {
  padding: 28px;
  background: var(--bg-card);
}
.neutron-col:first-child { border-right: 1px solid var(--border-subtle); }
.neutron-col.highlight { background: rgba(0, 212, 255, 0.04); }
.neutron-header {
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.neutron-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}
.neutron-row-label {
  font-size: 13px;
  color: var(--text-muted);
}
.neutron-row-value {
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
}

/* ═══════════════════════════════════════════════════════════
   WARNING / CAUTION CARDS
   ═══════════════════════════════════════════════════════════ */
.caution-card {
  background: rgba(245, 158, 11, 0.04);
  border: 1px solid rgba(245, 158, 11, 0.2);
  border-radius: var(--radius);
  padding: 20px 24px;
  margin: 24px 0;
  display: flex;
  gap: 16px;
  align-items: flex-start;
}
.caution-icon {
  font-size: 20px;
  flex-shrink: 0;
  margin-top: 2px;
}
.caution-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--accent-amber);
  margin-bottom: 4px;
}
.caution-text {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.6;
}

/* ═══════════════════════════════════════════════════════════
   GAUGE (FUEL TANK)
   ═══════════════════════════════════════════════════════════ */
.gauge-container { margin: 32px 0; }
.gauge-bar {
  width: 100%;
  height: 32px;
  background: rgba(255,255,255,0.04);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
  border: 1px solid var(--border-subtle);
}
.gauge-fill {
  height: 100%;
  border-radius: 16px;
  background: linear-gradient(90deg, var(--accent-cyan), var(--accent-violet));
  transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}
.gauge-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-muted);
}

/* ═══════════════════════════════════════════════════════════
   ORBITAL PATHS (VALUATION)
   ═══════════════════════════════════════════════════════════ */
.orbit-container {
  position: relative;
  width: 100%;
  max-width: 600px;
  margin: 0 auto 40px;
}

/* ═══════════════════════════════════════════════════════════
   TAKEAWAY CARDS
   ═══════════════════════════════════════════════════════════ */
.takeaway-list { display: flex; flex-direction: column; gap: 16px; margin: 32px 0; }
.takeaway {
  display: flex;
  gap: 16px;
  align-items: flex-start;
  padding: 20px 24px;
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius);
  transition: var(--transition);
}
.takeaway:hover { border-color: var(--border-glow); }
.takeaway-num {
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--accent-cyan);
  background: rgba(0, 212, 255, 0.08);
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.takeaway-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
.takeaway-text { font-size: 13px; color: var(--text-secondary); line-height: 1.6; }

/* ═══════════════════════════════════════════════════════════
   CATALYST TIMELINE
   ═══════════════════════════════════════════════════════════ */
.catalyst-timeline {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 32px 0;
  position: relative;
  padding-left: 24px;
  border-left: 2px solid rgba(0, 212, 255, 0.15);
}
.catalyst-item {
  padding: 16px 0 16px 24px;
  position: relative;
}
.catalyst-item::before {
  content: '';
  position: absolute;
  left: -7px; top: 22px;
  width: 12px; height: 12px;
  border-radius: 50%;
  background: var(--bg-deep);
  border: 2px solid var(--accent-cyan);
}
.catalyst-date {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--accent-cyan);
  margin-bottom: 4px;
}
.catalyst-title { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
.catalyst-desc { font-size: 13px; color: var(--text-secondary); }

/* ═══════════════════════════════════════════════════════════
   FOOTER / DISCLAIMER
   ═══════════════════════════════════════════════════════════ */
.disclaimer {
  text-align: center;
  padding: 60px 24px 40px;
  font-size: 11px;
  color: var(--text-muted);
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.7;
  border-top: 1px solid var(--border-subtle);
}

/* ═══════════════════════════════════════════════════════════
   TOOLTIP
   ═══════════════════════════════════════════════════════════ */
.chart-tooltip {
  position: fixed;
  pointer-events: none;
  background: rgba(5, 10, 18, 0.95);
  border: 1px solid rgba(0, 212, 255, 0.25);
  border-radius: 10px;
  padding: 12px 16px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-primary);
  box-shadow: 0 0 20px rgba(0, 212, 255, 0.1), 0 8px 32px rgba(0,0,0,0.4);
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.15s ease;
  max-width: 260px;
  line-height: 1.5;
}
.chart-tooltip.visible { opacity: 1; }
.tt-label { color: var(--text-muted); font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
.tt-value { font-size: 16px; font-weight: 600; }
.tt-detail { color: var(--text-secondary); margin-top: 4px; }

/* ═══════════════════════════════════════════════════════════
   D3 CHART AXIS STYLES
   ═══════════════════════════════════════════════════════════ */
.axis text {
  font-family: var(--font-mono);
  font-size: 11px;
  fill: var(--text-muted);
}
.axis line, .axis path {
  stroke: rgba(255,255,255,0.08);
}
.grid line {
  stroke: rgba(255,255,255,0.04);
  stroke-dasharray: 2 4;
}
.grid path { stroke: none; }
.annotation-line {
  stroke: rgba(255,255,255,0.15);
  stroke-dasharray: 3 3;
}
.annotation-text {
  font-family: var(--font-mono);
  font-size: 10px;
  fill: var(--text-muted);
}

/* ═══════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════ */
@media (max-width: 1024px) {
  .integration-container { grid-template-columns: 1fr; }
  .contract-grid { grid-template-columns: 1fr; }
}
@media (max-width: 768px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .card-grid { grid-template-columns: 1fr; }
  .neutron-comp { grid-template-columns: 1fr; }
  .neutron-col:first-child { border-right: none; border-bottom: 1px solid var(--border-subtle); }
  .progress-track { display: none; }
  section { padding: 60px 0; }
  .chart-wrap { padding: 20px; }
  .nav-link { font-size: 11px; padding: 4px 8px; }
}
@media (max-width: 480px) {
  .stats-grid { grid-template-columns: 1fr; }
  .stat-value { font-size: 24px; }
  .contract-value { font-size: 28px; }
  .contract-total-value { font-size: 36px; }
  .hero h1 { font-size: 42px; }
}

/* ═══════════════ SITE NAV ═══════════════ */
.bigpic-nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 10000;
  background: rgba(5, 10, 18, 0.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(0, 212, 255, 0.08);
  padding: 0 24px;
  height: 52px;
  display: flex;
  align-items: center;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
.bigpic-nav a { text-decoration: none; }
.bigpic-nav .nav-brand {
  font-weight: 700;
  font-size: 1rem;
  background: linear-gradient(135deg, #e2e8f0, var(--accent-cyan));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-right: 32px;
}
.bigpic-nav .nav-links {
  display: flex;
  align-items: center;
  gap: 4px;
}
.bigpic-nav .nav-link {
  color: var(--text-muted);
  font-size: 0.82rem;
  font-weight: 500;
  padding: 6px 12px;
  border-radius: 6px;
  transition: 0.2s ease;
}
.bigpic-nav .nav-link:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
.bigpic-nav .nav-dropdown { position: relative; }
.bigpic-nav .nav-dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: rgba(5, 10, 18, 0.96);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(0, 212, 255, 0.1);
  border-radius: 10px;
  padding: 6px;
  min-width: 220px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}
.bigpic-nav .nav-dropdown:hover .nav-dropdown-menu { display: block; }
.bigpic-nav .nav-dropdown-menu a {
  display: block;
  color: var(--text-muted);
  font-size: 0.82rem;
  padding: 8px 12px;
  border-radius: 6px;
  transition: 0.2s ease;
}
.bigpic-nav .nav-dropdown-menu a:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }

/* ═══════════════ SHARE BUTTON ═══════════════ */
.share-wrapper {
  position: fixed;
  top: 62px;
  right: 1.5rem;
  z-index: 9999;
}
.share-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.55rem 1rem;
  background: rgba(5, 10, 18, 0.85);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid rgba(0, 212, 255, 0.25);
  border-radius: 6px;
  color: var(--accent-cyan);
  font-family: inherit;
  font-size: 0.75rem;
  font-weight: 500;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: all 0.25s ease;
}
.share-btn:hover {
  background: rgba(5, 10, 18, 0.95);
  border-color: rgba(0, 212, 255, 0.5);
}
.share-btn svg {
  width: 14px;
  height: 14px;
  fill: none;
  stroke: var(--accent-cyan);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.share-dropdown {
  position: absolute;
  top: calc(100% + 0.5rem);
  right: 0;
  min-width: 200px;
  background: rgba(5, 10, 18, 0.95);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(0, 212, 255, 0.2);
  border-radius: 8px;
  padding: 0.4rem;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-6px);
  transition: all 0.2s ease;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
.share-dropdown.open {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}
.share-option {
  display: flex;
  align-items: center;
  gap: 0.65rem;
  width: 100%;
  padding: 0.6rem 0.75rem;
  background: none;
  border: none;
  border-radius: 5px;
  color: var(--text-secondary);
  font-family: inherit;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.15s ease;
  text-decoration: none;
}
.share-option:hover {
  background: rgba(0, 212, 255, 0.12);
  color: var(--accent-cyan);
}
.share-option svg {
  width: 15px;
  height: 15px;
  flex-shrink: 0;
}
.share-option .x-logo {
  fill: var(--text-secondary);
  stroke: none;
}
.share-option:hover .x-logo {
  fill: var(--accent-cyan);
}
.share-option .link-icon {
  fill: none;
  stroke: var(--text-secondary);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.share-option:hover .link-icon {
  stroke: var(--accent-cyan);
}
.share-copied {
  font-size: 0.7rem;
  color: var(--accent-green);
  padding: 0;
  height: 0;
  overflow: hidden;
  opacity: 0;
  transition: all 0.2s ease;
}
.share-copied.show {
  padding: 0.3rem 0.75rem;
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>

<nav class="bigpic-nav">
  <a href="../../../index.html" class="nav-brand">BigPic Solutions</a>
  <div class="nav-links">
    <div class="nav-dropdown">
      <a class="nav-link" href="#">Sectors &#9662;</a>
      <div class="nav-dropdown-menu">
        <a href="../../../research/ai/report.html">AI Infrastructure</a>
        <a href="../../../research/nuclear/report.html">Nuclear Energy</a>
        <a href="../../../research/space/report.html">Space</a>
        <a href="../../../research/quantum/report.html">Quantum Computing</a>
        <a href="../../../research/robotics/report.html">Robotics &amp; Automation</a>
        <a href="../../../research/cybersecurity/report.html">Cybersecurity</a>
        <a href="../../../research/critical-minerals/report.html">Critical Minerals</a>
        <a href="../../../research/defense/report.html">Defense &amp; Aerospace</a>
        <a href="../../../research/energy-storage/report.html">Energy Storage</a>
      </div>
    </div>
    <a class="nav-link" href="../../../eagle-eye/">Eagle Eye</a>
  </div>
</nav>

<!-- SHARE -->
<div class="share-wrapper">
  <button class="share-btn" onclick="toggleShare()" aria-label="Share this article">
    <svg viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
    SHARE
  </button>
  <div class="share-dropdown" id="shareDropdown">
    <button class="share-option" onclick="copyLink()">
      <svg class="link-icon" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
      Copy link
    </button>
    <a class="share-option" id="shareX" href="#" target="_blank" rel="noopener noreferrer" onclick="shareToX()">
      <svg class="x-logo" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      Share on X
    </a>
    <div class="share-copied" id="shareCopied">Link copied!</div>
  </div>
</div>

<script>
const SHARE_URL = 'https://markets.bigpicsolutions.com/research/supplementary/RocketLab/RKLB-Flight-Profile.html';
const SHARE_TEXT = 'Rocket Lab (RKLB) — Flight Profile. An interactive investment thesis for Rocket Lab USA, Inc. — from launchpad to orbit.';

function toggleShare() {
  document.getElementById('shareDropdown').classList.toggle('open');
}
function copyLink() {
  navigator.clipboard.writeText(SHARE_URL).then(() => {
    const el = document.getElementById('shareCopied');
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 2000);
  });
}
function shareToX() {
  const url = 'https://x.com/intent/tweet?text=' + encodeURIComponent(SHARE_TEXT) + '&url=' + encodeURIComponent(SHARE_URL);
  document.getElementById('shareX').href = url;
}
document.addEventListener('click', (e) => {
  if (!e.target.closest('.share-wrapper')) {
    document.getElementById('shareDropdown').classList.remove('open');
  }
});
</script>

<!-- ═══════════════════════════════════════════════════════════
     STARFIELD CANVAS
     ═══════════════════════════════════════════════════════════ -->
<canvas id="starfield"></canvas>

<!-- ═══════════════════════════════════════════════════════════
     TOOLTIP (shared)
     ═══════════════════════════════════════════════════════════ -->
<div class="chart-tooltip" id="tooltip"></div>

<!-- ═══════════════════════════════════════════════════════════
     SCROLL PROGRESS INDICATOR
     ═══════════════════════════════════════════════════════════ -->
<div class="progress-track" id="progress-track">
  <div class="progress-rocket" id="progress-rocket">&#x1F680;</div>
  <div class="progress-line">
    <div class="progress-fill" id="progress-fill"></div>
  </div>
  <div class="progress-altitude" id="progress-alt">0 km</div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     NAVIGATION
     ═══════════════════════════════════════════════════════════ -->
<nav class="nav" id="nav">
  <div class="nav-inner">
    <span class="nav-brand">RKLB</span>
    <a href="#hero" class="nav-link active" data-section="hero">Briefing</a>
    <a href="#electron" class="nav-link" data-section="electron">Ignition</a>
    <a href="#financials" class="nav-link" data-section="financials">Max-Q</a>
    <a href="#sda" class="nav-link" data-section="sda">Staging</a>
    <a href="#neutron" class="nav-link" data-section="neutron">SES-1</a>
    <a href="#valuation" class="nav-link" data-section="valuation">Orbit</a>
    <a href="#summary" class="nav-link" data-section="summary">Complete</a>
  </div>
</nav>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 1: PRE-LAUNCH BRIEFING (HERO)
     ═══════════════════════════════════════════════════════════ -->
<section class="hero" id="hero">
  <div class="hero-badge">Mission Briefing &mdash; RKLB &mdash; February 2026</div>
  <h1>Rocket Lab</h1>
  <p class="hero-subtitle">From launchpad to orbit &mdash; a vertical integration thesis</p>
  <div class="hero-thesis">
    "The only public end-to-end space company. Strong business, priced for perfection."
  </div>
  <div class="stats-grid">
    <div class="stat-card cyan">
      <div class="stat-value">~$38B</div>
      <div class="stat-label">Market Cap</div>
    </div>
    <div class="stat-card green">
      <div class="stat-value">~$600M</div>
      <div class="stat-label">Revenue FY25E</div>
    </div>
    <div class="stat-card green">
      <div class="stat-value">$1.9B+</div>
      <div class="stat-label">Backlog</div>
    </div>
    <div class="stat-card cyan">
      <div class="stat-value">81</div>
      <div class="stat-label">Electron Launches</div>
    </div>
    <div class="stat-card amber">
      <div class="stat-value">~64x</div>
      <div class="stat-label">P/S (Trailing)</div>
    </div>
    <div class="stat-card green">
      <div class="stat-value">100%</div>
      <div class="stat-label">2025 Success Rate</div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: T-0 LIFTOFF ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">T-0 &middot; Liftoff</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 2: IGNITION / LIFTOFF (ELECTRON)
     ═══════════════════════════════════════════════════════════ -->
<section id="electron">
  <div class="container">
    <div class="section-phase">Phase 01 &mdash; Ignition</div>
    <h2 class="section-title">The Proven Engine</h2>
    <p class="section-desc">
      Electron is the world's most frequently launched small orbital rocket. 81 missions.
      21 consecutive successes in 2025. A 48-hour turnaround record. The heartbeat is accelerating.
    </p>

    <!-- Launch Cadence Bar Chart -->
    <div class="chart-wrap">
      <div class="chart-title">Launch Cadence</div>
      <div class="chart-subtitle">Annual Electron launches &mdash; success vs. failure</div>
      <div class="chart-container" id="chart-launches"></div>
    </div>

    <!-- ASP Growth -->
    <div class="chart-wrap">
      <div class="chart-title">Pricing Power</div>
      <div class="chart-subtitle">Average revenue per Electron launch ($M)</div>
      <div class="chart-container" id="chart-asp"></div>
    </div>

    <!-- Success Streak Counter -->
    <div class="counter-ring" id="counter-streak">
      <svg width="140" height="140" viewBox="0 0 140 140">
        <circle cx="70" cy="70" r="58" fill="none" stroke="rgba(255,255,255,0.04)" stroke-width="8"/>
        <circle cx="70" cy="70" r="58" fill="none" stroke="var(--accent-green)" stroke-width="8"
          stroke-dasharray="0 365" stroke-linecap="round" transform="rotate(-90 70 70)"
          id="streak-ring"/>
      </svg>
      <div class="counter-number" id="streak-number">0</div>
      <div class="counter-label">Consecutive Successful Launches</div>
    </div>

    <div class="capcom">
      <div class="capcom-label">CAPCOM</div>
      <div class="capcom-text">
        Second-most-active launcher globally in 2025. The only dedicated small-lift option with
        national security clearances and proven reliability. Pricing power: ASP doubled from
        $5.8M to $10M+ in four years.
      </div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: MECO ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">MECO &middot; Main Engine Cutoff</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 3: MAX-Q (FINANCIALS)
     ═══════════════════════════════════════════════════════════ -->
<section id="financials">
  <div class="container">
    <div class="section-phase">Phase 02 &mdash; Max-Q</div>
    <h2 class="section-title">Maximum Dynamic Pressure</h2>
    <p class="section-desc">
      The financials are under maximum stress &mdash; but also maximum momentum.
      Revenue is accelerating. Margins are expanding. The trajectory is clear.
    </p>

    <!-- Revenue Altitude Curve -->
    <div class="chart-wrap">
      <div class="chart-title">Revenue Trajectory</div>
      <div class="chart-subtitle">Annual revenue ($M) &mdash; 76% CAGR from 2021&ndash;2025</div>
      <div class="chart-container" id="chart-revenue"></div>
    </div>

    <!-- Margin Expansion -->
    <div class="chart-wrap">
      <div class="chart-title">Margin Expansion</div>
      <div class="chart-subtitle">Gross margin progression &mdash; from legacy drag to SDA scale</div>
      <div class="toggle-wrap">
        <span class="toggle-option active" id="tog-gaap">GAAP</span>
        <div class="toggle-track" id="margin-toggle">
          <div class="toggle-thumb"></div>
        </div>
        <span class="toggle-option" id="tog-ngaap">Non-GAAP</span>
      </div>
      <div class="chart-container" id="chart-margins"></div>
    </div>

    <!-- Segment Split -->
    <div class="chart-wrap">
      <div class="chart-title">Revenue Mix</div>
      <div class="chart-subtitle">Launch Services vs. Space Systems &mdash; structural 71% split since 2022</div>
      <div class="chart-container" id="chart-segments"></div>
    </div>

    <!-- Profitability Path -->
    <div class="chart-wrap">
      <div class="chart-title">Path to Profitability</div>
      <div class="chart-subtitle">Key inflection points on the road to positive earnings</div>
      <div class="catalyst-timeline" id="profit-timeline">
        <div class="catalyst-item">
          <div class="catalyst-date">Q3 2025</div>
          <div class="catalyst-title">37% GAAP Gross Margin (Record)</div>
          <div class="catalyst-desc">SDA production ramp + Electron pricing power driving expansion</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">Late 2026</div>
          <div class="catalyst-title">Adj. EBITDA Breakeven</div>
          <div class="catalyst-desc">Operating leverage as Neutron R&D peaks and revenue scales</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">FY 2027</div>
          <div class="catalyst-title">Positive Free Cash Flow</div>
          <div class="catalyst-desc">CapEx normalizes post-Neutron; SDA recurring revenue kicks in</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">FY 2027&ndash;2028</div>
          <div class="catalyst-title">GAAP Net Income Positive</div>
          <div class="catalyst-desc">Potential S&P 500 eligibility &mdash; billions in passive index buying</div>
        </div>
      </div>
    </div>

    <div class="capcom">
      <div class="capcom-label">CAPCOM</div>
      <div class="capcom-text">
        76% revenue CAGR. Gross margins doubled in two years. Still burning cash ($208M FCF deficit
        through 9 months of 2025), but $808M in cash provides 3+ years of runway.
        The acceleration is real &mdash; the question is whether the market has already priced it in.
      </div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: STAGING ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">Staging &middot; Separation</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 4: STAGE SEPARATION (SDA TRANSFORMATION)
     ═══════════════════════════════════════════════════════════ -->
<section id="sda">
  <div class="container">
    <div class="section-phase">Phase 03 &mdash; Stage Separation</div>
    <h2 class="section-title">The Transformation</h2>
    <p class="section-desc">
      Rocket Lab is no longer just a launch company. $1.33 billion in SDA contracts,
      six strategic acquisitions, and end-to-end satellite manufacturing have transformed it
      into a vertically integrated space prime &mdash; competing alongside Lockheed, Northrop, and L3Harris.
    </p>

    <!-- SDA Contract Cards -->
    <div class="contract-grid">
      <div class="contract-card" id="card-t2">
        <div class="contract-name">SDA Tranche 2 &mdash; Transport Layer Beta</div>
        <div class="contract-value">$515M</div>
        <div class="contract-detail">
          18 satellites &middot; Secure military data relay<br>
          ~$28.6M per satellite &middot; Launch by Jul 2027
        </div>
      </div>
      <div class="contract-card" id="card-t3">
        <div class="contract-name">SDA Tranche 3 &mdash; Tracking Layer</div>
        <div class="contract-value">$816M</div>
        <div class="contract-detail">
          18 satellites &middot; Missile warning &amp; tracking<br>
          ~$45M per satellite &middot; Launch FY2029
        </div>
      </div>
    </div>
    <div class="contract-total">
      <div class="contract-total-label">Total SDA Backlog</div>
      <div class="contract-total-value" id="sda-total">$1.33B+</div>
    </div>

    <!-- Cost Competitiveness -->
    <div class="chart-wrap">
      <div class="chart-title">Cost Competitiveness</div>
      <div class="chart-subtitle">SDA Tranche 3 per-satellite cost vs. legacy defense primes</div>
      <div class="chart-container" id="chart-sda-cost"></div>
    </div>

    <!-- Vertical Integration Stack -->
    <div class="chart-wrap">
      <div class="chart-title">The End-to-End Stack</div>
      <div class="chart-subtitle">No other public company offers this level of vertical integration</div>
      <div class="integration-container" id="integration-stack">
        <div class="chart-container" id="integration-svg-wrap"></div>
        <div class="integration-legend" id="integration-legend"></div>
      </div>
    </div>

    <!-- Acquisition Timeline -->
    <div class="chart-wrap">
      <div class="chart-title">Acquisition Strategy</div>
      <div class="chart-subtitle">$400M+ invested across 6 acquisitions to build the stack</div>
      <div class="chart-container" id="chart-acquisitions"></div>
    </div>

    <div class="capcom">
      <div class="capcom-label">CAPCOM</div>
      <div class="capcom-text">
        From $80M solar cell acquisition to $1.33B in government contracts. RKLB's per-satellite cost
        ($45M) is competitive with Lockheed Martin ($61M) despite having 50&ndash;100x less revenue.
        The small company is bidding at the big table &mdash; and winning.
      </div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: SES-1 ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">SES-1 &middot; Second Engine Start</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 5: SECOND STAGE IGNITION (NEUTRON)
     ═══════════════════════════════════════════════════════════ -->
<section id="neutron">
  <div class="container">
    <div class="section-phase">Phase 04 &mdash; Second Stage Ignition</div>
    <h2 class="section-title">The Neutron Bet</h2>
    <p class="section-desc">
      A medium-lift reusable rocket targeting the Falcon 9 market.
      At $38B market cap, Neutron success is already priced in.
      This is the binary catalyst &mdash; the bet that defines the next chapter.
    </p>

    <!-- Caution: Tank Rupture -->
    <div class="caution-card">
      <div class="caution-icon">&#9888;</div>
      <div>
        <div class="caution-title">January 2026: Stage 1 Tank Rupture</div>
        <div class="caution-text">
          A Neutron Stage 1 qualification tank ruptured during testing on January 21, 2026.
          The previous Q1 2026 first-flight target is no longer achievable.
          New timeline: mid-to-late 2026. Q4 earnings (Feb 26) expected to provide updated guidance.
        </div>
      </div>
    </div>

    <!-- Neutron vs Falcon 9 -->
    <div class="neutron-comp">
      <div class="neutron-col highlight">
        <div class="neutron-header">
          <span style="color: var(--accent-cyan);">&#9670;</span> Neutron
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Payload (LEO, reusable)</span>
          <span class="neutron-row-value">13,000 kg</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Payload (LEO, expendable)</span>
          <span class="neutron-row-value">15,000 kg</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Engines</span>
          <span class="neutron-row-value">9x Archimedes</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Propellant</span>
          <span class="neutron-row-value">LOX / Methane</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Target Price</span>
          <span class="neutron-row-value" style="color: var(--accent-green);">$50&ndash;55M</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Liftoff Thrust</span>
          <span class="neutron-row-value">~1,450,000 lbf</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">First Flight</span>
          <span class="neutron-row-value" style="color: var(--accent-amber);">Mid-2026 (target)</span>
        </div>
        <div class="neutron-row" style="border: none;">
          <span class="neutron-row-label">Flights</span>
          <span class="neutron-row-value">0</span>
        </div>
      </div>
      <div class="neutron-col">
        <div class="neutron-header">
          <span style="color: var(--text-muted);">&#9670;</span> Falcon 9
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Payload (LEO, reusable)</span>
          <span class="neutron-row-value">15,600 kg</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Payload (LEO, expendable)</span>
          <span class="neutron-row-value">22,800 kg</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Engines</span>
          <span class="neutron-row-value">9x Merlin</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Propellant</span>
          <span class="neutron-row-value">RP-1 / LOX</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">List Price</span>
          <span class="neutron-row-value">~$67M</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">Liftoff Thrust</span>
          <span class="neutron-row-value">1,710,000 lbf</span>
        </div>
        <div class="neutron-row">
          <span class="neutron-row-label">First Flight</span>
          <span class="neutron-row-value">June 2010</span>
        </div>
        <div class="neutron-row" style="border: none;">
          <span class="neutron-row-label">Flights</span>
          <span class="neutron-row-value">615+</span>
        </div>
      </div>
    </div>

    <!-- Capital Requirements Gauge -->
    <div class="chart-wrap">
      <div class="chart-title">Neutron Development Spend</div>
      <div class="chart-subtitle">Cumulative investment vs. estimated total cost</div>
      <div class="gauge-container" id="neutron-gauge">
        <div class="gauge-bar">
          <div class="gauge-fill" id="gauge-fill" style="width: 0%"></div>
        </div>
        <div class="gauge-labels">
          <span>$0</span>
          <span id="gauge-spent">$360M spent</span>
          <span>~$660&ndash;960M total</span>
        </div>
      </div>
    </div>

    <!-- TAM Bubbles -->
    <div class="chart-wrap">
      <div class="chart-title">Markets Unlocked</div>
      <div class="chart-subtitle">Total addressable market segments Neutron opens access to</div>
      <div class="chart-container" id="chart-tam"></div>
    </div>

    <div class="capcom">
      <div class="capcom-label">CAPCOM</div>
      <div class="capcom-text">
        The hardest bet in the thesis. Nine Archimedes engines. 1.45 million pounds of thrust.
        $50&ndash;55M target price undercuts Falcon 9 by 18&ndash;25%. But zero flights,
        a fresh setback, and $300&ndash;600M more to spend. The market is paying for success
        before it happens.
      </div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: SECO ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">SECO &middot; Orbit Insertion</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 6: ORBITAL INSERTION (VALUATION)
     ═══════════════════════════════════════════════════════════ -->
<section id="valuation">
  <div class="container">
    <div class="section-phase">Phase 05 &mdash; Orbital Insertion</div>
    <h2 class="section-title">Three Possible Orbits</h2>
    <p class="section-desc">
      The business is strong. The question is the price. At ~$71/share and ~64x trailing P/S,
      the market is pricing in significant execution. Probability-weighted expected value:
      $45&ndash;55/share &mdash; suggesting 20&ndash;35% overvaluation at current levels.
    </p>

    <!-- Orbital Paths Visualization -->
    <div class="chart-wrap">
      <div class="chart-title">Scenario Analysis</div>
      <div class="chart-subtitle">Three trajectories &mdash; which orbit does RKLB achieve?</div>
      <div class="chart-container" id="chart-orbits"></div>
    </div>

    <!-- Comparable Company Scatter -->
    <div class="chart-wrap">
      <div class="chart-title">Valuation in Context</div>
      <div class="chart-subtitle">P/S ratio vs. revenue growth &mdash; where RKLB sits among peers</div>
      <div class="chart-container" id="chart-comps"></div>
    </div>

    <!-- Risk Matrix -->
    <div class="chart-wrap">
      <div class="chart-title">Risk Matrix</div>
      <div class="chart-subtitle">Probability vs. severity of key thesis risks</div>
      <div class="chart-container" id="chart-risks"></div>
    </div>

    <!-- Stress Test -->
    <div class="expand-card" id="stress-test">
      <div class="expand-header" onclick="toggleExpand(this)">
        <span class="expand-title" style="color: var(--accent-coral);">&#9888; Stress Test: Moderate Disappointment Scenario</span>
        <span class="expand-icon">+</span>
      </div>
      <div class="expand-body">
        <div class="expand-content">
          <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.7; margin-bottom: 16px;">
            <strong style="color: var(--accent-amber);">If Neutron delays to 2028</strong> and FY2026 revenue comes in
            at ~$750M (below the $892M consensus), the implied fair value drops to
            <strong style="color: var(--accent-coral);">$21&ndash;36/share</strong> &mdash;
            representing <strong>47&ndash;69% downside</strong> from the current $70.86.
          </p>
          <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.7;">
            This scenario doesn't require anything to go catastrophically wrong &mdash; just moderate delays
            and slightly below-consensus revenue. The valuation premium leaves no margin of safety for
            execution stumbles.
          </p>
        </div>
      </div>
    </div>

    <div class="capcom">
      <div class="capcom-label">CAPCOM</div>
      <div class="capcom-text">
        The base case ($42&ndash;57) implies 20&ndash;40% downside. The bull case ($95&ndash;130)
        requires flawless Neutron execution and continued hypergrowth. At 64x trailing P/S,
        RKLB trades at a premium to Palantir's growth trajectory. The business deserves a premium
        &mdash; but how much is enough?
      </div>
    </div>
  </div>
</section>

<!-- ═══ MILESTONE: ORBIT ACHIEVED ═══ -->
<div class="milestone" data-milestone>
  <div class="milestone-line"></div>
  <div class="milestone-label">Orbit Achieved</div>
  <div class="milestone-line"></div>
</div>

<!-- ═══════════════════════════════════════════════════════════
     SECTION 7: MISSION COMPLETE (SUMMARY)
     ═══════════════════════════════════════════════════════════ -->
<section id="summary">
  <div class="container">
    <div class="section-phase">Mission Complete</div>
    <h2 class="section-title">Key Takeaways</h2>

    <div class="takeaway-list">
      <div class="takeaway">
        <div class="takeaway-num">1</div>
        <div>
          <div class="takeaway-title">The business is strong and getting stronger</div>
          <div class="takeaway-text">
            76% revenue CAGR, 37% gross margins, $1.9B+ backlog, 100% launch success in 2025.
            Rocket Lab is executing at an elite level across both launch and space systems.
          </div>
        </div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">2</div>
        <div>
          <div class="takeaway-title">Valuation is the primary risk</div>
          <div class="takeaway-text">
            At ~64x trailing P/S and ~$38B market cap, RKLB is priced for near-perfect execution.
            The probability-weighted fair value ($45&ndash;55) suggests 20&ndash;35% overvaluation today.
          </div>
        </div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">3</div>
        <div>
          <div class="takeaway-title">Neutron is binary</div>
          <div class="takeaway-text">
            Success unlocks NSSL contracts, mega-constellation deployment, and a $10B+ TAM.
            Failure or extended delays could compress the multiple by 40&ndash;60%. January's tank rupture
            adds uncertainty.
          </div>
        </div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">4</div>
        <div>
          <div class="takeaway-title">SDA contracts are transformational</div>
          <div class="takeaway-text">
            $1.33B across 36 satellites positions RKLB as a legitimate defense space prime.
            Per-satellite costs competitive with Lockheed and Northrop despite 50&ndash;100x less revenue.
          </div>
        </div>
      </div>
      <div class="takeaway">
        <div class="takeaway-num">5</div>
        <div>
          <div class="takeaway-title">Risk/reward favors patience</div>
          <div class="takeaway-text">
            Better entry points likely in the $40&ndash;55 range, where the risk/reward
            becomes asymmetric. At current levels, the downside scenarios outweigh the upside on
            a probability-weighted basis.
          </div>
        </div>
      </div>
    </div>

    <!-- Catalyst Watchlist -->
    <div class="chart-wrap">
      <div class="chart-title">Catalyst Watchlist</div>
      <div class="chart-subtitle">Key dates that could move the thesis</div>
      <div class="catalyst-timeline">
        <div class="catalyst-item">
          <div class="catalyst-date">Feb 26, 2026</div>
          <div class="catalyst-title">Q4 Earnings + Neutron Timeline Update</div>
          <div class="catalyst-desc">First official guidance post-tank rupture. Revenue guidance for FY2026.</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">Mar 6, 2026</div>
          <div class="catalyst-title">Artemis II Launch</div>
          <div class="catalyst-desc">First crewed lunar flyby since Apollo. Sector-wide sentiment catalyst.</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">Mid-2026</div>
          <div class="catalyst-title">SpaceX / xAI IPO</div>
          <div class="catalyst-desc">Sector-defining repricing event. Likely re-rates all space equities.</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">Mid&ndash;Late 2026</div>
          <div class="catalyst-title">Neutron First Flight</div>
          <div class="catalyst-desc">The binary moment. Success validates the bull case; failure compresses the multiple.</div>
        </div>
        <div class="catalyst-item">
          <div class="catalyst-date">Jul 2027</div>
          <div class="catalyst-title">SDA Tranche 2 Satellite Launches</div>
          <div class="catalyst-desc">First 18 RKLB-built satellites reach orbit. Proves prime contractor capability.</div>
        </div>
      </div>
    </div>

    <!-- Entry Guidance -->
    <div class="data-card" style="text-align: center; max-width: 500px; margin: 32px auto;">
      <div class="data-card-label">Preferred Entry Zone</div>
      <div class="data-card-value" style="color: var(--accent-green);">$40 &ndash; $55</div>
      <div class="data-card-detail">
        Better risk/reward where base-case downside is limited and bull-case upside is 2&ndash;3x.
        Current price: <span style="color: var(--accent-amber); font-family: var(--font-mono);">$70.86</span>
      </div>
    </div>
  </div>
</section>

<!-- ═══════════════════════════════════════════════════════════
     DISCLAIMER
     ═══════════════════════════════════════════════════════════ -->
<div class="disclaimer">
  <strong style="color: var(--text-secondary);">Disclaimer</strong><br>
  This report is for educational and research purposes only. It does not constitute investment advice,
  a recommendation, or a solicitation to buy or sell any securities. All data is believed accurate as of
  February 22, 2026 but is not guaranteed. Markets involve risk. Past performance does not guarantee
  future results. Always conduct your own research before making investment decisions.
  <br><br>
  <span style="color: var(--text-muted);">BigPic Capital Research &mdash; February 2026</span>
</div>

<!-- ═══════════════════════════════════════════════════════════
     JAVASCRIPT
     ═══════════════════════════════════════════════════════════ -->
<script>
// ═══════════════════════════════════════════════════════════
// DATA CONSTANTS
// ═══════════════════════════════════════════════════════════
const DATA = {
  launches: [
    { year: 2017, success: 0, fail: 1, total: 1 },
    { year: 2018, success: 3, fail: 0, total: 3 },
    { year: 2019, success: 6, fail: 0, total: 6 },
    { year: 2020, success: 6, fail: 1, total: 7 },
    { year: 2021, success: 5, fail: 1, total: 6 },
    { year: 2022, success: 9, fail: 0, total: 9 },
    { year: 2023, success: 9, fail: 1, total: 10 },
    { year: 2024, success: 16, fail: 0, total: 16 },
    { year: 2025, success: 21, fail: 0, total: 21 },
    { year: 2026, success: 2, fail: 0, total: 2 },
  ],
  asp: [
    { year: 2021, value: 6.4 },
    { year: 2022, value: 6.7 },
    { year: 2023, value: 7.2 },
    { year: 2024, value: 7.8 },
    { year: 2025, value: 10.0 },
  ],
  revenue: [
    { year: 2020, value: 35, est: false },
    { year: 2021, value: 62.2, est: false },
    { year: 2022, value: 211, est: false },
    { year: 2023, value: 244.6, est: false },
    { year: 2024, value: 436.2, est: false },
    { year: 2025, value: 600, est: true },
    { year: 2026, value: 892, est: true },
  ],
  margins: [
    { q: 'FY23', gaap: 21, ngaap: 26 },
    { q: 'Q1 24', gaap: 26.0, ngaap: 30 },
    { q: 'Q2 24', gaap: 25.6, ngaap: 30.7 },
    { q: 'Q3 24', gaap: 27, ngaap: 31 },
    { q: 'Q4 24', gaap: 27.8, ngaap: 32 },
    { q: 'Q1 25', gaap: 28.8, ngaap: 33 },
    { q: 'Q2 25', gaap: 32.1, ngaap: 36.9 },
    { q: 'Q3 25', gaap: 37.0, ngaap: 41.9 },
  ],
  segments: [
    { year: 2021, launch: 38.5, space: 23.7 },
    { year: 2022, launch: 60.7, space: 150.3 },
    { year: 2023, launch: 71.9, space: 172.7 },
    { year: 2024, launch: 125.4, space: 310.8 },
    { year: 2025, launch: 165, space: 435 },
  ],
  sdaCost: [
    { name: 'Northrop Grumman', cost: 42, highlight: false },
    { name: 'Rocket Lab', cost: 45, highlight: true },
    { name: 'L3Harris', cost: 47, highlight: false },
    { name: 'Lockheed Martin', cost: 61, highlight: false },
  ],
  integrationStack: [
    { name: 'Spacecraft Bus', detail: 'Lightning / Photon / Flatellite', source: 'Organic', price: '', color: '#00d4ff', y: 0 },
    { name: 'Solar Cells', detail: 'SolAero (1 of 2 US producers)', source: 'Acquired Jan 2022', price: '$80M', color: '#4d9fff', y: 1 },
    { name: 'Reaction Wheels', detail: 'Sinclair heritage', source: 'Acquired Apr 2020', price: 'Undiscl.', color: '#8b5cf6', y: 2 },
    { name: 'Star Trackers', detail: 'Sinclair heritage', source: 'Acquired Apr 2020', price: 'Undiscl.', color: '#8b5cf6', y: 3 },
    { name: 'Flight Software', detail: 'ASI MAX platform', source: 'Acquired Oct 2021', price: '$40M', color: '#10b981', y: 4 },
    { name: 'Separation Systems', detail: 'Planetary Systems Corp', source: 'Acquired Dec 2021', price: '$81.4M', color: '#f59e0b', y: 5 },
    { name: 'EO/IR Payloads', detail: 'Geost sensors', source: 'Acquired Aug 2025', price: '$275M', color: '#f43f5e', y: 6 },
    { name: 'Laser Comms', detail: 'Mynaric CONDOR', source: 'Pending 2026', price: '~$75M', color: '#22d3ee', y: 7 },
  ],
  acquisitions: [
    { name: 'Sinclair', date: 2020.3, price: null, label: 'Apr 2020', capability: 'Reaction wheels, star trackers' },
    { name: 'ASI', date: 2021.75, price: 40, label: 'Oct 2021', capability: 'Flight software' },
    { name: 'PSC', date: 2021.95, price: 81.4, label: 'Dec 2021', capability: 'Separation systems' },
    { name: 'SolAero', date: 2022.05, price: 80, label: 'Jan 2022', capability: 'Space solar cells' },
    { name: 'Geost', date: 2025.6, price: 275, label: 'Aug 2025', capability: 'EO/IR sensors' },
    { name: 'Mynaric', date: 2026.0, price: 75, label: 'Pending', capability: 'Laser communications' },
  ],
  scenarios: [
    { name: 'Bull Case', range: '$95 – $130', prob: '20–25%', color: '#10b981', mid: 112.5,
      desc: 'Neutron flies on time, NSSL wins, 50%+ revenue growth sustained through 2028' },
    { name: 'Base Case', range: '$42 – $57', prob: '50–55%', color: '#00d4ff', mid: 49.5,
      desc: 'Solid execution, Neutron flies late 2026/early 2027, growth normalizes to 30–40%' },
    { name: 'Bear Case', range: '$10 – $19', prob: '20–25%', color: '#f43f5e', mid: 14.5,
      desc: 'Neutron multi-year delay, margin compression, sector de-rating, dilution' },
  ],
  comps: [
    { name: 'Palantir', ticker: 'PLTR', ps: 72, growth: 56, mcap: 323, color: '#8b5cf6' },
    { name: 'Rocket Lab', ticker: 'RKLB', ps: 64, growth: 48, mcap: 38, color: '#00d4ff' },
    { name: 'Anduril', ticker: 'Private', ps: 80, growth: 138, mcap: 79.6, color: '#f59e0b' },
    { name: 'Firefly', ticker: 'ACIC', ps: 52, growth: 10, mcap: 3.2, color: '#22d3ee' },
    { name: 'Lockheed Martin', ticker: 'LMT', ps: 2.0, growth: 6, mcap: 151, color: '#505a6e' },
    { name: 'Northrop Grumman', ticker: 'NOC', ps: 2.4, growth: 5, mcap: 100, color: '#505a6e' },
    { name: 'L3Harris', ticker: 'LHX', ps: 3.0, growth: 6, mcap: 66.5, color: '#505a6e' },
  ],
  risks: [
    { name: 'Valuation Compression', severity: 5, probability: 3, color: '#f43f5e',
      desc: 'Multiple contraction if growth decelerates or sector de-rates' },
    { name: 'Neutron Execution', severity: 4.5, probability: 3.5, color: '#f43f5e',
      desc: 'Further delays, cost overruns, or first-flight failure' },
    { name: 'Fixed-Price Margin Risk', severity: 4, probability: 3, color: '#f59e0b',
      desc: 'SDA contracts are fixed-price — cost overruns eat directly into margins' },
    { name: 'SpaceX Dominance', severity: 3, probability: 3, color: '#f59e0b',
      desc: 'SpaceX could undercut pricing or capture RKLB target markets' },
    { name: 'Cash Burn', severity: 3, probability: 4, color: '#f59e0b',
      desc: 'Neutron development draining $200M+/year; 3-year runway but dilution risk' },
    { name: 'Dilution', severity: 3, probability: 3, color: '#8b5cf6',
      desc: 'Convertible notes ($347M) deep ITM; additional raises possible' },
  ],
  tam: [
    { name: 'NSSL Contracts', value: 5.6, unit: '$5.6B ceiling', color: '#00d4ff' },
    { name: 'Mega-Constellations', value: 4, unit: '$4B+ annually', color: '#4d9fff' },
    { name: 'Commercial LEO', value: 2.5, unit: '$2.5B+', color: '#8b5cf6' },
    { name: 'Point-to-Point Cargo', value: 1, unit: '$1B+ (future)', color: '#10b981' },
    { name: 'Electron (current)', value: 0.3, unit: '$300M', color: '#505a6e' },
  ],
};

// ═══════════════════════════════════════════════════════════
// UTILITIES
// ═══════════════════════════════════════════════════════════
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => document.querySelectorAll(sel);
const tooltip = $('#tooltip');

function showTooltip(e, html) {
  tooltip.innerHTML = html;
  tooltip.classList.add('visible');
  const x = Math.min(e.clientX + 16, window.innerWidth - 280);
  const y = Math.min(e.clientY - 10, window.innerHeight - 150);
  tooltip.style.left = x + 'px';
  tooltip.style.top = y + 'px';
}
function hideTooltip() { tooltip.classList.remove('visible'); }
function fmt(n) { return n >= 1000 ? '$' + (n/1000).toFixed(1) + 'B' : '$' + n + 'M'; }
function fmtPct(n) { return n.toFixed(1) + '%'; }

// ═══════════════════════════════════════════════════════════
// STARFIELD
// ═══════════════════════════════════════════════════════════
(function initStarfield() {
  const canvas = document.getElementById('starfield');
  const ctx = canvas.getContext('2d');
  let stars = [];
  const COUNT = window.innerWidth < 768 ? 200 : 500;

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  function createStars() {
    stars = [];
    for (let i = 0; i < COUNT; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 1.5 + 0.3,
        a: Math.random() * 0.6 + 0.1,
        speed: Math.random() * 0.3 + 0.05,
        phase: Math.random() * Math.PI * 2,
      });
    }
  }

  function draw(t) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const scroll = window.scrollY;
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    const progress = maxScroll > 0 ? scroll / maxScroll : 0;

    stars.forEach(s => {
      const twinkle = Math.sin(t * 0.001 * s.speed + s.phase) * 0.3 + 0.7;
      const alpha = s.a * twinkle * (0.4 + progress * 0.6);
      const py = ((s.y - scroll * s.speed * 0.1) % canvas.height + canvas.height) % canvas.height;
      ctx.beginPath();
      ctx.arc(s.x, py, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(200, 220, 255, ${alpha})`;
      ctx.fill();
    });
    requestAnimationFrame(draw);
  }

  resize();
  createStars();
  requestAnimationFrame(draw);
  window.addEventListener('resize', () => { resize(); createStars(); });
})();

// ═══════════════════════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════════════════════
(function initNav() {
  const nav = $('#nav');
  let lastScroll = 0;

  window.addEventListener('scroll', () => {
    const y = window.scrollY;
    if (y > 400) {
      nav.classList.add('visible');
    } else {
      nav.classList.remove('visible');
    }
    lastScroll = y;
  });

  $$('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const target = document.querySelector(link.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });
})();

// ═══════════════════════════════════════════════════════════
// SCROLL PROGRESS INDICATOR
// ═══════════════════════════════════════════════════════════
(function initProgress() {
  const fill = $('#progress-fill');
  const alt = $('#progress-alt');

  window.addEventListener('scroll', () => {
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    const progress = maxScroll > 0 ? Math.min(window.scrollY / maxScroll, 1) : 0;
    fill.style.height = (progress * 100) + '%';
    const altitude = Math.round(progress * 400);
    alt.textContent = altitude + ' km';
  });
})();

// ═══════════════════════════════════════════════════════════
// GSAP SETUP
// ═══════════════════════════════════════════════════════════
gsap.registerPlugin(ScrollTrigger);

// Milestone markers
$$('[data-milestone]').forEach(m => {
  ScrollTrigger.create({
    trigger: m,
    start: 'top 85%',
    onEnter: () => m.classList.add('visible'),
    once: true,
  });
});

// Nav active state
const sections = ['hero', 'electron', 'financials', 'sda', 'neutron', 'valuation', 'summary'];
sections.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  ScrollTrigger.create({
    trigger: el,
    start: 'top 50%',
    end: 'bottom 50%',
    onToggle: self => {
      if (self.isActive) {
        $$('.nav-link').forEach(l => l.classList.remove('active'));
        const active = $(`.nav-link[data-section="${id}"]`);
        if (active) active.classList.add('active');
      }
    }
  });
});

// ═══════════════════════════════════════════════════════════
// EXPAND CARDS
// ═══════════════════════════════════════════════════════════
function toggleExpand(header) {
  const card = header.parentElement;
  const body = card.querySelector('.expand-body');
  const isOpen = card.classList.contains('open');
  card.classList.toggle('open');
  if (isOpen) {
    body.style.maxHeight = '0';
  } else {
    body.style.maxHeight = body.scrollHeight + 'px';
  }
}

// ═══════════════════════════════════════════════════════════
// SECTION 2: ELECTRON CHARTS
// ═══════════════════════════════════════════════════════════

// ─── Launch Cadence Bar Chart ───
function buildLaunchChart() {
  const container = document.getElementById('chart-launches');
  const W = container.clientWidth || 700;
  const H = 320;
  const margin = { top: 20, right: 20, bottom: 40, left: 45 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-launches').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.launches;
  const x = d3.scaleBand().domain(data.map(d => d.year)).range([0, w]).padding(0.35);
  const y = d3.scaleLinear().domain([0, 25]).range([h, 0]);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(5).tickSize(-w).tickFormat(''));

  // Legend
  const legend = svg.append('g').attr('transform', `translate(${W - 190}, 12)`);
  legend.append('rect').attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-cyan)').attr('opacity', 0.85);
  legend.append('text').attr('x', 18).attr('y', 10).text('Success').attr('fill', 'var(--text-muted)').attr('font-size', '11px').attr('font-family', 'var(--font-mono)');
  legend.append('rect').attr('x', 80).attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-coral)').attr('opacity', 0.85);
  legend.append('text').attr('x', 98).attr('y', 10).text('Failure').attr('fill', 'var(--text-muted)').attr('font-size', '11px').attr('font-family', 'var(--font-mono)');

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).tickSize(0)).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(5)).select('.domain').remove();

  // Success bars
  const successBars = g.selectAll('.bar-success').data(data).enter()
    .append('rect')
    .attr('class', 'bar-success')
    .attr('x', d => x(d.year))
    .attr('width', x.bandwidth())
    .attr('y', h)
    .attr('height', 0)
    .attr('fill', 'var(--accent-cyan)')
    .attr('rx', 3)
    .attr('opacity', 0.85);

  // Fail bars (stacked on top)
  const failBars = g.selectAll('.bar-fail').data(data.filter(d => d.fail > 0)).enter()
    .append('rect')
    .attr('class', 'bar-fail')
    .attr('x', d => x(d.year))
    .attr('width', x.bandwidth())
    .attr('y', h)
    .attr('height', 0)
    .attr('fill', 'var(--accent-coral)')
    .attr('rx', 3)
    .attr('opacity', 0.85);

  // Labels on bars
  const labels = g.selectAll('.bar-label').data(data).enter()
    .append('text')
    .attr('class', 'annotation-text')
    .attr('x', d => x(d.year) + x.bandwidth() / 2)
    .attr('y', h)
    .attr('text-anchor', 'middle')
    .attr('opacity', 0)
    .text(d => d.total);

  // Animate with D3 transitions
  successBars.transition().duration(800).delay((d, i) => i * 80)
    .attr('y', d => y(d.success))
    .attr('height', d => h - y(d.success))
    .on('end', function(d, i) {
      if (i === data.length - 1) {
        labels.attr('y', d => y(d.total) - 8).attr('opacity', 1);
      }
    });
  failBars.transition().duration(800).delay((d, i) => i * 80 + 300)
    .attr('y', d => y(d.success + d.fail))
    .attr('height', d => h - y(d.fail));

  // Tooltips
  g.selectAll('.bar-success, .bar-fail')
    .on('mousemove', function(e) {
      const d = d3.select(this).datum();
      showTooltip(e, `
        <div class="tt-label">${d.year}</div>
        <div class="tt-value" style="color:var(--accent-cyan)">${d.total} launches</div>
        <div class="tt-detail">${d.success} success${d.fail ? `, ${d.fail} fail` : ''}</div>
        <div class="tt-detail">Success rate: ${((d.success / d.total) * 100).toFixed(0)}%</div>
      `);
    })
    .on('mouseleave', hideTooltip);
}

// ─── ASP Growth Line Chart ───
function buildASPChart() {
  const container = document.getElementById('chart-asp');
  const W = container.clientWidth || 700;
  const H = 260;
  const margin = { top: 20, right: 30, bottom: 40, left: 50 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-asp').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.asp;
  const x = d3.scaleLinear().domain([2021, 2025]).range([0, w]);
  const y = d3.scaleLinear().domain([5, 11]).range([h, 0]);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(4).tickSize(-w).tickFormat(''));

  // Area gradient
  const gradId = 'asp-grad';
  const defs = svg.append('defs');
  const grad = defs.append('linearGradient').attr('id', gradId)
    .attr('x1', '0').attr('y1', '0').attr('x2', '0').attr('y2', '1');
  grad.append('stop').attr('offset', '0%').attr('stop-color', '#00d4ff').attr('stop-opacity', 0.3);
  grad.append('stop').attr('offset', '100%').attr('stop-color', '#00d4ff').attr('stop-opacity', 0);

  // Area
  const area = d3.area()
    .x(d => x(d.year)).y0(h).y1(d => y(d.value))
    .curve(d3.curveMonotoneX);
  g.append('path').datum(data).attr('d', area)
    .attr('fill', `url(#${gradId})`).attr('opacity', 0);

  // Line
  const line = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);
  const path = g.append('path').datum(data).attr('d', line)
    .attr('fill', 'none').attr('stroke', 'var(--accent-cyan)').attr('stroke-width', 2.5);
  const totalLen = path.node().getTotalLength();
  path.attr('stroke-dasharray', totalLen).attr('stroke-dashoffset', totalLen);

  // Dots
  const dots = g.selectAll('.asp-dot').data(data).enter()
    .append('circle')
    .attr('cx', d => x(d.year)).attr('cy', d => y(d.value))
    .attr('r', 5).attr('fill', 'var(--bg-deep)').attr('stroke', 'var(--accent-cyan)')
    .attr('stroke-width', 2).attr('opacity', 0);

  // Value labels
  const valLabels = g.selectAll('.asp-val').data(data).enter()
    .append('text').attr('class', 'annotation-text')
    .attr('x', d => x(d.year)).attr('y', d => y(d.value) - 14)
    .attr('text-anchor', 'middle').attr('fill', 'var(--accent-cyan)')
    .attr('opacity', 0)
    .text(d => '$' + d.value.toFixed(1) + 'M');

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).ticks(5).tickFormat(d3.format('d')).tickSize(0)).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(4).tickFormat(d => '$' + d + 'M')).select('.domain').remove();

  // Animate
  gsap.to(path.node(), { strokeDashoffset: 0, duration: 1.5, ease: 'power2.inOut',
    onComplete: () => {
      g.select('path[fill^="url"]').attr('opacity', 1);
      dots.attr('opacity', 1);
      valLabels.attr('opacity', 1);
    }
  });

  // Tooltips
  dots.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.year}</div>
      <div class="tt-value" style="color:var(--accent-cyan)">$${d.value.toFixed(1)}M / launch</div>
      <div class="tt-detail">+${((d.value / 5.8 - 1) * 100).toFixed(0)}% from 2020 baseline</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Success Streak Counter ───
function animateStreak() {
  const ring = document.getElementById('streak-ring');
  const num = document.getElementById('streak-number');
  const target = 39;
  const circumference = 2 * Math.PI * 58;
  const targetDash = (target / 50) * circumference;

  gsap.to({ val: 0 }, {
    val: target,
    duration: 2,
    ease: 'power2.out',
    onUpdate: function() {
      const v = Math.round(this.targets()[0].val);
      num.textContent = v;
      const dash = (v / 50) * circumference;
      ring.setAttribute('stroke-dasharray', `${dash} ${circumference - dash}`);
    }
  });
}

// ═══════════════════════════════════════════════════════════
// SECTION 3: FINANCIAL CHARTS
// ═══════════════════════════════════════════════════════════

// ─── Revenue Altitude Curve ───
function buildRevenueChart() {
  const container = document.getElementById('chart-revenue');
  const W = container.clientWidth || 700;
  const H = 380;
  const margin = { top: 30, right: 40, bottom: 45, left: 60 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-revenue').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const defs = svg.append('defs');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.revenue;
  const x = d3.scaleLinear().domain([2020, 2026]).range([0, w]);
  const y = d3.scaleLinear().domain([0, 950]).range([h, 0]);

  // Area gradient
  const gradId = 'rev-grad';
  const grad = defs.append('linearGradient').attr('id', gradId)
    .attr('x1', '0').attr('y1', '0').attr('x2', '0').attr('y2', '1');
  grad.append('stop').attr('offset', '0%').attr('stop-color', '#00d4ff').attr('stop-opacity', 0.25);
  grad.append('stop').attr('offset', '80%').attr('stop-color', '#8b5cf6').attr('stop-opacity', 0.03);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(5).tickSize(-w).tickFormat(''));

  // Area (actual)
  const actualData = data.filter(d => !d.est);
  const allArea = d3.area().x(d => x(d.year)).y0(h).y1(d => y(d.value)).curve(d3.curveMonotoneX);
  g.append('path').datum(data).attr('d', allArea)
    .attr('fill', `url(#${gradId})`).attr('opacity', 0).attr('class', 'rev-area');

  // Line (actual)
  const actualLine = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);
  const solidPath = g.append('path').datum(actualData).attr('d', actualLine)
    .attr('fill', 'none').attr('stroke', 'var(--accent-cyan)').attr('stroke-width', 3);
  const solidLen = solidPath.node().getTotalLength();
  solidPath.attr('stroke-dasharray', solidLen).attr('stroke-dashoffset', solidLen);

  // Line (estimates — dashed)
  const estData = data.filter(d => d.est || d.year === 2024);
  const dashPath = g.append('path').datum(estData).attr('d', actualLine)
    .attr('fill', 'none').attr('stroke', 'var(--accent-violet)').attr('stroke-width', 2.5)
    .attr('stroke-dasharray', '8 5').attr('opacity', 0);

  // Dots
  const dots = g.selectAll('.rev-dot').data(data).enter()
    .append('circle')
    .attr('cx', d => x(d.year)).attr('cy', d => y(d.value))
    .attr('r', d => d.est ? 4 : 5)
    .attr('fill', d => d.est ? 'var(--accent-violet)' : 'var(--accent-cyan)')
    .attr('stroke', 'var(--bg-deep)').attr('stroke-width', 2)
    .attr('opacity', 0);

  // Value labels
  const valLabels = g.selectAll('.rev-label').data(data).enter()
    .append('text').attr('class', 'annotation-text')
    .attr('x', d => x(d.year)).attr('y', d => y(d.value) - 16)
    .attr('text-anchor', 'middle')
    .attr('fill', d => d.est ? 'var(--accent-violet)' : 'var(--accent-cyan)')
    .attr('font-size', '11px').attr('opacity', 0)
    .text(d => fmt(d.value) + (d.est ? 'E' : ''));

  // Annotation: CAGR
  g.append('text').attr('class', 'annotation-text')
    .attr('x', x(2023)).attr('y', y(500))
    .attr('text-anchor', 'middle').attr('fill', 'var(--accent-cyan)')
    .attr('font-size', '12px').attr('opacity', 0).attr('class', 'rev-cagr')
    .text('76% CAGR (2021–2025)');

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).ticks(7).tickFormat(d3.format('d')).tickSize(0)).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(5).tickFormat(d => '$' + d + 'M')).select('.domain').remove();

  // Animate
  gsap.to(solidPath.node(), { strokeDashoffset: 0, duration: 2, ease: 'power2.inOut',
    onComplete: () => {
      g.select('.rev-area').attr('opacity', 1);
      dashPath.attr('opacity', 1);
      dots.attr('opacity', 1);
      valLabels.attr('opacity', 1);
      g.select('.rev-cagr').attr('opacity', 0.6);
    }
  });

  // Tooltips
  dots.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    const prev = data.find(p => p.year === d.year - 1);
    const growth = prev ? ((d.value / prev.value - 1) * 100).toFixed(0) : '—';
    showTooltip(e, `
      <div class="tt-label">${d.year}${d.est ? ' (estimate)' : ''}</div>
      <div class="tt-value" style="color:${d.est ? 'var(--accent-violet)' : 'var(--accent-cyan)'}">${fmt(d.value)}</div>
      <div class="tt-detail">YoY Growth: ${growth}%</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Margin Expansion Chart ───
function buildMarginChart() {
  const container = document.getElementById('chart-margins');
  const W = container.clientWidth || 700;
  const H = 300;
  const margin = { top: 20, right: 30, bottom: 40, left: 50 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-margins').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.margins;
  const x = d3.scaleBand().domain(data.map(d => d.q)).range([0, w]).padding(0.1);
  const y = d3.scaleLinear().domain([15, 48]).range([h, 0]);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(5).tickSize(-w).tickFormat(''));

  // GAAP bars
  const gaapBars = g.selectAll('.bar-gaap').data(data).enter()
    .append('rect')
    .attr('x', d => x(d.q) + x.bandwidth() * 0.1)
    .attr('width', x.bandwidth() * 0.35)
    .attr('y', h).attr('height', 0)
    .attr('fill', 'var(--accent-cyan)').attr('rx', 3).attr('opacity', 0.8);

  // Non-GAAP bars
  const ngaapBars = g.selectAll('.bar-ngaap').data(data.filter(d => d.ngaap)).enter()
    .append('rect')
    .attr('x', d => x(d.q) + x.bandwidth() * 0.55)
    .attr('width', x.bandwidth() * 0.35)
    .attr('y', h).attr('height', 0)
    .attr('fill', 'var(--accent-violet)').attr('rx', 3).attr('opacity', 0.8);

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).tickSize(0)).select('.domain').remove();
  g.selectAll('.axis text').style('font-size', '10px');
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + '%')).select('.domain').remove();

  // Legend
  const legend = svg.append('g').attr('transform', `translate(${W - 180}, 12)`);
  legend.append('rect').attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-cyan)');
  legend.append('text').attr('x', 18).attr('y', 10).text('GAAP').attr('fill', 'var(--text-muted)').attr('font-size', '11px');
  legend.append('rect').attr('x', 65).attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-violet)');
  legend.append('text').attr('x', 83).attr('y', 10).text('Non-GAAP').attr('fill', 'var(--text-muted)').attr('font-size', '11px');

  // Animate bars with D3 transitions
  gaapBars.transition().duration(800).delay((d, i) => i * 60)
    .attr('y', d => y(d.gaap))
    .attr('height', d => h - y(d.gaap));
  ngaapBars.transition().duration(800).delay((d, i) => i * 60 + 200)
    .attr('y', d => y(d.ngaap))
    .attr('height', d => h - y(d.ngaap));

  // Tooltips
  gaapBars.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.q}</div>
      <div class="tt-value" style="color:var(--accent-cyan)">${fmtPct(d.gaap)} GAAP</div>
      ${d.ngaap ? `<div class="tt-detail">${fmtPct(d.ngaap)} Non-GAAP</div>` : ''}
    `);
  }).on('mouseleave', hideTooltip);

  ngaapBars.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.q}</div>
      <div class="tt-value" style="color:var(--accent-violet)">${fmtPct(d.ngaap)} Non-GAAP</div>
      <div class="tt-detail">${fmtPct(d.gaap)} GAAP</div>
    `);
  }).on('mouseleave', hideTooltip);

  // Toggle functionality
  let showNgaap = false;
  const toggle = document.getElementById('margin-toggle');
  const togGaap = document.getElementById('tog-gaap');
  const togNgaap = document.getElementById('tog-ngaap');

  toggle.addEventListener('click', () => {
    showNgaap = !showNgaap;
    toggle.classList.toggle('on', showNgaap);
    togGaap.classList.toggle('active', !showNgaap);
    togNgaap.classList.toggle('active', showNgaap);

    gaapBars.transition().duration(400)
      .attr('opacity', showNgaap ? 0.3 : 0.8);
    ngaapBars.transition().duration(400)
      .attr('opacity', showNgaap ? 0.9 : 0.8);
  });
}

// ─── Revenue Segment Split ───
function buildSegmentChart() {
  const container = document.getElementById('chart-segments');
  const W = container.clientWidth || 700;
  const H = 300;
  const margin = { top: 20, right: 30, bottom: 40, left: 55 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-segments').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.segments;
  const x = d3.scaleBand().domain(data.map(d => d.year)).range([0, w]).padding(0.35);
  const y = d3.scaleLinear().domain([0, 650]).range([h, 0]);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(5).tickSize(-w).tickFormat(''));

  // Space Systems bars (bottom)
  const spaceBars = g.selectAll('.bar-space').data(data).enter()
    .append('rect')
    .attr('x', d => x(d.year)).attr('width', x.bandwidth())
    .attr('y', h).attr('height', 0)
    .attr('fill', 'var(--accent-violet)').attr('rx', 3).attr('opacity', 0.8);

  // Launch Services bars (top, stacked)
  const launchBars = g.selectAll('.bar-launch').data(data).enter()
    .append('rect')
    .attr('x', d => x(d.year)).attr('width', x.bandwidth())
    .attr('y', h).attr('height', 0)
    .attr('fill', 'var(--accent-cyan)').attr('rx', 3).attr('opacity', 0.8);

  // % labels
  const pctLabels = g.selectAll('.seg-pct').data(data).enter()
    .append('text').attr('class', 'annotation-text')
    .attr('x', d => x(d.year) + x.bandwidth() / 2)
    .attr('y', d => y(d.launch + d.space) - 10)
    .attr('text-anchor', 'middle').attr('opacity', 0)
    .text(d => Math.round(d.space / (d.launch + d.space) * 100) + '% SS');

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).tickSize(0)).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(5).tickFormat(d => '$' + d + 'M')).select('.domain').remove();

  // Legend
  const legend = svg.append('g').attr('transform', `translate(${W - 240}, 12)`);
  legend.append('rect').attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-cyan)');
  legend.append('text').attr('x', 18).attr('y', 10).text('Launch Services').attr('fill', 'var(--text-muted)').attr('font-size', '11px');
  legend.append('rect').attr('x', 120).attr('width', 12).attr('height', 12).attr('rx', 2).attr('fill', 'var(--accent-violet)');
  legend.append('text').attr('x', 138).attr('y', 10).text('Space Systems').attr('fill', 'var(--text-muted)').attr('font-size', '11px');

  // Animate with D3 transitions
  spaceBars.transition().duration(800).delay((d, i) => i * 100)
    .attr('y', d => y(d.space))
    .attr('height', d => h - y(d.space));
  launchBars.transition().duration(800).delay((d, i) => i * 100 + 300)
    .attr('y', d => y(d.launch + d.space))
    .attr('height', d => h - y(d.launch))
    .on('end', function(d, i) {
      if (i === data.length - 1) pctLabels.attr('opacity', 0.7);
    });

  // Tooltips
  spaceBars.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    const total = d.launch + d.space;
    showTooltip(e, `
      <div class="tt-label">${d.year}</div>
      <div class="tt-value" style="color:var(--accent-violet)">${fmt(d.space)} Space Systems</div>
      <div class="tt-detail">${fmt(d.launch)} Launch Services</div>
      <div class="tt-detail">Total: ${fmt(total)}</div>
    `);
  }).on('mouseleave', hideTooltip);

  launchBars.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    const total = d.launch + d.space;
    showTooltip(e, `
      <div class="tt-label">${d.year}</div>
      <div class="tt-value" style="color:var(--accent-cyan)">${fmt(d.launch)} Launch Services</div>
      <div class="tt-detail">${fmt(d.space)} Space Systems</div>
      <div class="tt-detail">Total: ${fmt(total)}</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ── ScrollTrigger: Sections 2 & 3 ──
ScrollTrigger.create({ trigger: '#chart-launches', start: 'top 80%', onEnter: buildLaunchChart, once: true });
ScrollTrigger.create({ trigger: '#chart-asp', start: 'top 80%', onEnter: buildASPChart, once: true });
ScrollTrigger.create({ trigger: '#counter-streak', start: 'top 80%', onEnter: animateStreak, once: true });
ScrollTrigger.create({ trigger: '#chart-revenue', start: 'top 80%', onEnter: buildRevenueChart, once: true });
ScrollTrigger.create({ trigger: '#chart-margins', start: 'top 80%', onEnter: buildMarginChart, once: true });
ScrollTrigger.create({ trigger: '#chart-segments', start: 'top 80%', onEnter: buildSegmentChart, once: true });

// ═══════════════════════════════════════════════════════════
// SECTION 4: SDA / TRANSFORMATION CHARTS
// ═══════════════════════════════════════════════════════════

// ─── SDA Cost Competitiveness Horizontal Bar ───
function buildSdaCostChart() {
  const container = document.getElementById('chart-sda-cost');
  const W = container.clientWidth || 700;
  const H = 220;
  const margin = { top: 10, right: 60, bottom: 20, left: 140 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-sda-cost').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.sdaCost;
  const x = d3.scaleLinear().domain([0, 70]).range([0, w]);
  const y = d3.scaleBand().domain(data.map(d => d.name)).range([0, h]).padding(0.3);

  // Bars
  const bars = g.selectAll('.cost-bar').data(data).enter()
    .append('rect')
    .attr('x', 0).attr('y', d => y(d.name))
    .attr('width', 0).attr('height', y.bandwidth())
    .attr('fill', d => d.highlight ? 'var(--accent-cyan)' : 'rgba(255,255,255,0.1)')
    .attr('rx', 4);

  // Value labels
  const valLabels = g.selectAll('.cost-val').data(data).enter()
    .append('text').attr('class', 'annotation-text')
    .attr('x', 0).attr('y', d => y(d.name) + y.bandwidth() / 2 + 4)
    .attr('opacity', 0)
    .attr('fill', d => d.highlight ? 'var(--accent-cyan)' : 'var(--text-secondary)')
    .attr('font-size', '13px').attr('font-weight', d => d.highlight ? '600' : '400')
    .text(d => '$' + d.cost + 'M');

  // Name labels
  g.selectAll('.cost-name').data(data).enter()
    .append('text')
    .attr('x', -8).attr('y', d => y(d.name) + y.bandwidth() / 2 + 4)
    .attr('text-anchor', 'end')
    .attr('font-size', '13px')
    .attr('fill', d => d.highlight ? 'var(--accent-cyan)' : 'var(--text-secondary)')
    .attr('font-weight', d => d.highlight ? '600' : '400')
    .text(d => d.name);

  // Animate with D3 transitions
  bars.transition().duration(1000).delay((d, i) => i * 120)
    .attr('width', d => x(d.cost))
    .on('end', function(d, i) {
      if (i === data.length - 1) {
        valLabels.attr('x', d => x(d.cost) + 8).attr('opacity', 1);
      }
    });

  // Tooltips
  bars.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    const diff = d.highlight ? '' : ` (${d.cost > 45 ? '+' : ''}${((d.cost / 45 - 1) * 100).toFixed(0)}% vs RKLB)`;
    showTooltip(e, `
      <div class="tt-label">${d.name}</div>
      <div class="tt-value" style="color:${d.highlight ? 'var(--accent-cyan)' : 'var(--text-primary)'}">$${d.cost}M per satellite</div>
      <div class="tt-detail">SDA Tranche 3 Tracking Layer${diff}</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Vertical Integration Stack SVG ───
function buildIntegrationStack() {
  const svgWrap = document.getElementById('integration-svg-wrap');
  const legend = document.getElementById('integration-legend');
  const data = DATA.integrationStack;
  const W = 260;
  const rowH = 38;
  const H = data.length * rowH + 40;

  // Build SVG
  const svg = d3.select('#integration-svg-wrap').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');

  // Satellite body outline
  svg.append('rect')
    .attr('x', 20).attr('y', 10).attr('width', W - 40).attr('height', H - 20)
    .attr('rx', 12).attr('fill', 'none')
    .attr('stroke', 'rgba(255,255,255,0.08)').attr('stroke-width', 1)
    .attr('stroke-dasharray', '4 4');

  // Stack layers
  const layers = svg.selectAll('.stack-layer').data(data).enter().append('g')
    .attr('transform', (d, i) => `translate(30, ${i * rowH + 20})`)
    .attr('opacity', 0)
    .attr('cursor', 'pointer');

  layers.append('rect')
    .attr('width', W - 60).attr('height', rowH - 6)
    .attr('rx', 6)
    .attr('fill', d => d.color + '15')
    .attr('stroke', d => d.color + '40')
    .attr('stroke-width', 1);

  layers.append('text')
    .attr('x', 12).attr('y', rowH / 2 + 1)
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', d => d.color).attr('font-weight', '500')
    .text(d => d.name);

  // Animate layers staggered bottom-to-top
  const layerNodes = layers.nodes().reverse();
  gsap.to(layerNodes, { opacity: 1, duration: 0.4, stagger: 0.1, ease: 'power2.out' });

  // Build legend
  data.forEach((d, i) => {
    const item = document.createElement('div');
    item.className = 'integration-item';
    item.dataset.index = i;
    item.innerHTML = `
      <div class="integration-dot" style="background:${d.color}"></div>
      <div>
        <div class="integration-name">${d.name}</div>
        <div class="integration-detail">${d.detail}</div>
      </div>
      ${d.price ? `<div class="integration-price">${d.price}</div>` : ''}
    `;

    // Hover interaction
    item.addEventListener('mouseenter', () => {
      layers.attr('opacity', 0.3);
      d3.select(layers.nodes()[i]).attr('opacity', 1);
      item.classList.add('active');
    });
    item.addEventListener('mouseleave', () => {
      layers.attr('opacity', 1);
      item.classList.remove('active');
    });

    legend.appendChild(item);
  });

  // Layer hover
  layers.on('mouseenter', function(e, d) {
    layers.attr('opacity', 0.3);
    d3.select(this).attr('opacity', 1);
    const items = legend.querySelectorAll('.integration-item');
    items.forEach(it => it.classList.remove('active'));
    items[d.y].classList.add('active');
  }).on('mouseleave', () => {
    layers.attr('opacity', 1);
    legend.querySelectorAll('.integration-item').forEach(it => it.classList.remove('active'));
  }).on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.source}</div>
      <div class="tt-value" style="color:${d.color}">${d.name}</div>
      <div class="tt-detail">${d.detail}</div>
      ${d.price ? `<div class="tt-detail" style="color:var(--accent-cyan)">${d.price}</div>` : ''}
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Acquisition Timeline ───
function buildAcquisitionChart() {
  const container = document.getElementById('chart-acquisitions');
  const W = container.clientWidth || 700;
  const H = 200;
  const margin = { top: 30, right: 30, bottom: 40, left: 30 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-acquisitions').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.acquisitions;
  const x = d3.scaleLinear().domain([2019.5, 2026.5]).range([0, w]);

  // Timeline line
  g.append('line').attr('x1', 0).attr('y1', h / 2).attr('x2', w).attr('y2', h / 2)
    .attr('stroke', 'rgba(255,255,255,0.08)').attr('stroke-width', 2);

  // Nodes
  const nodes = g.selectAll('.acq-node').data(data).enter().append('g')
    .attr('transform', d => `translate(${x(d.date)}, ${h / 2})`)
    .attr('opacity', 0).attr('cursor', 'pointer');

  nodes.append('circle').attr('r', 8)
    .attr('fill', 'var(--bg-deep)').attr('stroke', 'var(--accent-cyan)')
    .attr('stroke-width', 2);
  nodes.append('circle').attr('r', 3).attr('fill', 'var(--accent-cyan)');

  // Labels (alternate above/below)
  nodes.append('text')
    .attr('y', (d, i) => i % 2 === 0 ? -20 : 24)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-display)').attr('font-size', '12px')
    .attr('fill', 'var(--text-primary)').attr('font-weight', '600')
    .text(d => d.name);

  nodes.append('text')
    .attr('y', (d, i) => i % 2 === 0 ? -34 : 38)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '10px')
    .attr('fill', d => d.price ? 'var(--accent-cyan)' : 'var(--text-muted)')
    .text(d => d.price ? '$' + d.price + 'M' : d.label);

  // Date labels below line
  nodes.append('text')
    .attr('y', (d, i) => i % 2 === 0 ? 24 : -20)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '9px')
    .attr('fill', 'var(--text-muted)')
    .text(d => d.label);

  // Animate
  gsap.to(nodes.nodes(), { opacity: 1, duration: 0.5, stagger: 0.15, ease: 'power2.out' });

  // Tooltips
  nodes.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.label}</div>
      <div class="tt-value" style="color:var(--accent-cyan)">${d.name}</div>
      <div class="tt-detail">${d.capability}</div>
      ${d.price ? `<div class="tt-detail" style="color:var(--accent-green)">$${d.price}M</div>` : ''}
    `);
  }).on('mouseleave', hideTooltip);
}

// ═══════════════════════════════════════════════════════════
// SECTION 5: NEUTRON CHARTS
// ═══════════════════════════════════════════════════════════

// ─── Neutron Capital Gauge ───
function animateGauge() {
  const fill = document.getElementById('gauge-fill');
  // $360M spent out of ~$810M midpoint estimate
  gsap.to(fill, { width: '44%', duration: 1.5, ease: 'power2.out' });
}

// ─── TAM Bubble Chart ───
function buildTAMChart() {
  const container = document.getElementById('chart-tam');
  const W = container.clientWidth || 700;
  const H = 280;

  const svg = d3.select('#chart-tam').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');

  const data = DATA.tam;
  const maxVal = d3.max(data, d => d.value);
  const rScale = d3.scaleSqrt().domain([0, maxVal]).range([20, 70]);

  // Position bubbles horizontally
  const spacing = W / (data.length + 1);
  const bubbles = svg.selectAll('.tam-bubble').data(data).enter().append('g')
    .attr('transform', (d, i) => `translate(${spacing * (i + 1)}, ${H / 2})`)
    .attr('cursor', 'pointer');

  // Circles
  bubbles.append('circle')
    .attr('r', 0)
    .attr('fill', d => d.color + '20')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 1.5);

  // Labels
  bubbles.append('text')
    .attr('text-anchor', 'middle').attr('dy', '-0.3em')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', d => d.color).attr('font-weight', '600')
    .attr('opacity', 0)
    .text(d => d.unit);

  bubbles.append('text')
    .attr('text-anchor', 'middle').attr('dy', '1.2em')
    .attr('font-size', '10px')
    .attr('fill', 'var(--text-muted)').attr('opacity', 0)
    .text(d => d.name);

  // Animate
  bubbles.selectAll('circle').transition().duration(1000).delay((d, i) => i * 150)
    .attr('r', d => rScale(d.value));
  bubbles.selectAll('text').transition().duration(500).delay((d, i) => i * 150 + 600)
    .attr('opacity', 1);

  // Tooltips
  bubbles.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    const isElectron = d.name === 'Electron (current)';
    showTooltip(e, `
      <div class="tt-label">${isElectron ? 'Current TAM' : 'Neutron Unlocks'}</div>
      <div class="tt-value" style="color:${d.color}">${d.unit}</div>
      <div class="tt-detail">${d.name}</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ── ScrollTrigger: Sections 4 & 5 ──
ScrollTrigger.create({ trigger: '#chart-sda-cost', start: 'top 80%', onEnter: buildSdaCostChart, once: true });
ScrollTrigger.create({ trigger: '#integration-stack', start: 'top 80%', onEnter: buildIntegrationStack, once: true });
ScrollTrigger.create({ trigger: '#chart-acquisitions', start: 'top 80%', onEnter: buildAcquisitionChart, once: true });
ScrollTrigger.create({ trigger: '#neutron-gauge', start: 'top 80%', onEnter: animateGauge, once: true });
ScrollTrigger.create({ trigger: '#chart-tam', start: 'top 80%', onEnter: buildTAMChart, once: true });

// ═══════════════════════════════════════════════════════════
// SECTION 6: VALUATION CHARTS
// ═══════════════════════════════════════════════════════════

// ─── Orbital Paths (Scenario Analysis) ───
function buildOrbitalChart() {
  const container = document.getElementById('chart-orbits');
  const W = container.clientWidth || 700;
  const H = 420;

  const svg = d3.select('#chart-orbits').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');

  const cx = W / 2;
  const cy = H / 2 + 20;
  const scenarios = DATA.scenarios;
  const currentPrice = 70.86;

  // Orbit radii
  const radii = [160, 110, 60]; // bull, base, bear
  const orbits = scenarios.map((s, i) => ({ ...s, rx: radii[i] * 1.3, ry: radii[i] * 0.55 }));

  // Draw orbits (ellipses)
  const orbitGroups = svg.selectAll('.orbit').data(orbits).enter().append('g')
    .attr('opacity', 0);

  orbitGroups.append('ellipse')
    .attr('cx', cx).attr('cy', cy)
    .attr('rx', d => d.rx).attr('ry', d => d.ry)
    .attr('fill', 'none')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 2)
    .attr('stroke-dasharray', (d, i) => i === 1 ? 'none' : '6 4')
    .attr('opacity', 0.5);

  // Orbit glow
  orbitGroups.append('ellipse')
    .attr('cx', cx).attr('cy', cy)
    .attr('rx', d => d.rx).attr('ry', d => d.ry)
    .attr('fill', 'none')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 6)
    .attr('opacity', 0.08)
    .attr('filter', 'blur(4px)');

  // Labels on orbits
  orbitGroups.append('text')
    .attr('x', cx + 10)
    .attr('y', (d, i) => cy - d.ry - 8)
    .attr('font-family', 'var(--font-mono)')
    .attr('font-size', '11px')
    .attr('fill', d => d.color)
    .attr('text-anchor', 'middle')
    .text(d => d.name);

  // Price range + probability labels
  orbitGroups.append('text')
    .attr('x', (d, i) => cx + d.rx + 12)
    .attr('y', cy + 4)
    .attr('font-family', 'var(--font-mono)')
    .attr('font-size', '12px')
    .attr('fill', d => d.color)
    .attr('font-weight', '600')
    .text(d => d.range);

  orbitGroups.append('text')
    .attr('x', (d, i) => cx + d.rx + 12)
    .attr('y', cy + 18)
    .attr('font-family', 'var(--font-mono)')
    .attr('font-size', '10px')
    .attr('fill', 'var(--text-muted)')
    .text(d => d.prob);

  // Current price marker (center)
  const marker = svg.append('g').attr('transform', `translate(${cx}, ${cy})`).attr('opacity', 0);
  marker.append('circle').attr('r', 8).attr('fill', 'var(--accent-amber)');
  marker.append('circle').attr('r', 14).attr('fill', 'none')
    .attr('stroke', 'var(--accent-amber)').attr('stroke-width', 1.5).attr('opacity', 0.5);
  marker.append('circle').attr('r', 20).attr('fill', 'none')
    .attr('stroke', 'var(--accent-amber)').attr('stroke-width', 1).attr('opacity', 0.2);
  marker.append('text')
    .attr('y', -28).attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '13px')
    .attr('fill', 'var(--accent-amber)').attr('font-weight', '600')
    .text('$' + currentPrice);
  marker.append('text')
    .attr('y', -42).attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '10px')
    .attr('fill', 'var(--text-muted)')
    .text('Current Price');

  // PWE label at bottom
  svg.append('text')
    .attr('x', cx).attr('y', H - 15)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '12px')
    .attr('fill', 'var(--text-secondary)').attr('opacity', 0).attr('class', 'pwe-label')
    .text('Probability-Weighted Expected Value: $45 – $55');

  // Animate
  gsap.to(orbitGroups.nodes(), { opacity: 1, duration: 0.6, stagger: 0.2, ease: 'power2.out' });
  gsap.to(marker.node(), { opacity: 1, duration: 0.5, delay: 0.8 });
  gsap.to('.pwe-label', { opacity: 0.7, duration: 0.5, delay: 1.2 });

  // Pulse animation on current price marker
  gsap.to(marker.selectAll('circle').nodes()[1], {
    attr: { r: 18 }, opacity: 0.2, duration: 1.5, repeat: -1, yoyo: true, ease: 'sine.inOut'
  });

  // Tooltips on orbits
  orbitGroups.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.name}</div>
      <div class="tt-value" style="color:${d.color}">${d.range}</div>
      <div class="tt-detail">Probability: ${d.prob}</div>
      <div class="tt-detail" style="margin-top:6px">${d.desc}</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Comparable Company Scatter Plot ───
function buildCompsChart() {
  const container = document.getElementById('chart-comps');
  const W = container.clientWidth || 700;
  const H = 380;
  const margin = { top: 30, right: 30, bottom: 50, left: 60 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-comps').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.comps;
  const x = d3.scaleLinear().domain([-5, 150]).range([0, w]);
  const y = d3.scaleLinear().domain([0, 90]).range([h, 0]);
  const r = d3.scaleSqrt().domain([0, 330]).range([6, 30]);

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(5).tickSize(-w).tickFormat(''));
  g.append('g').attr('class', 'grid')
    .call(d3.axisBottom(x).ticks(5).tickSize(-h).tickFormat(''))
    .attr('transform', `translate(0,${h})`);

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).ticks(6).tickFormat(d => d + '%')).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + 'x')).select('.domain').remove();

  // Axis labels
  g.append('text')
    .attr('x', w / 2).attr('y', h + 40)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', 'var(--text-muted)')
    .text('Revenue Growth (YoY)');
  g.append('text')
    .attr('x', -h / 2).attr('y', -45)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', 'var(--text-muted)')
    .attr('transform', 'rotate(-90)')
    .text('P/S Ratio');

  // Bubbles
  const bubbles = g.selectAll('.comp-bubble').data(data).enter().append('g')
    .attr('transform', d => `translate(${x(d.growth)}, ${y(d.ps)})`)
    .attr('opacity', 0).attr('cursor', 'pointer');

  bubbles.append('circle')
    .attr('r', d => r(d.mcap))
    .attr('fill', d => d.color + '25')
    .attr('stroke', d => d.color)
    .attr('stroke-width', d => d.ticker === 'RKLB' ? 2.5 : 1.5);

  // RKLB glow ring
  bubbles.filter(d => d.ticker === 'RKLB').append('circle')
    .attr('r', d => r(d.mcap) + 6)
    .attr('fill', 'none')
    .attr('stroke', 'var(--accent-cyan)')
    .attr('stroke-width', 1)
    .attr('opacity', 0.3);

  // Labels
  bubbles.append('text')
    .attr('dy', d => d.ticker === 'Private' ? r(d.mcap) + 16 : -r(d.mcap) - 8)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', d => d.color).attr('font-weight', '500')
    .text(d => d.ticker === 'RKLB' ? 'RKLB' : d.ticker);

  // Animate
  gsap.to(bubbles.nodes(), { opacity: 1, duration: 0.5, stagger: 0.1, ease: 'power2.out' });

  // Tooltips
  bubbles.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">${d.name} (${d.ticker})</div>
      <div class="tt-value" style="color:${d.color}">${d.ps}x P/S</div>
      <div class="tt-detail">Growth: ${d.growth}% YoY</div>
      <div class="tt-detail">Market Cap: $${d.mcap}B</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ─── Risk Matrix ───
function buildRiskChart() {
  const container = document.getElementById('chart-risks');
  const W = container.clientWidth || 700;
  const H = 340;
  const margin = { top: 30, right: 30, bottom: 50, left: 60 };
  const w = W - margin.left - margin.right;
  const h = H - margin.top - margin.bottom;

  const svg = d3.select('#chart-risks').append('svg')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');
  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

  const data = DATA.risks;
  const x = d3.scaleLinear().domain([1, 5]).range([0, w]);
  const y = d3.scaleLinear().domain([1, 5.5]).range([h, 0]);

  // Danger zone gradient (top-right)
  const defs = svg.append('defs');
  const radGrad = defs.append('radialGradient').attr('id', 'danger-zone')
    .attr('cx', '100%').attr('cy', '0%').attr('r', '80%');
  radGrad.append('stop').attr('offset', '0%').attr('stop-color', '#f43f5e').attr('stop-opacity', 0.08);
  radGrad.append('stop').attr('offset', '100%').attr('stop-color', '#f43f5e').attr('stop-opacity', 0);
  g.append('rect').attr('width', w).attr('height', h).attr('fill', 'url(#danger-zone)');

  // Grid
  g.append('g').attr('class', 'grid')
    .call(d3.axisLeft(y).ticks(4).tickSize(-w).tickFormat(''));
  g.append('g').attr('class', 'grid')
    .call(d3.axisBottom(x).ticks(4).tickSize(-h).tickFormat(''))
    .attr('transform', `translate(0,${h})`);

  // Axes
  g.append('g').attr('class', 'axis').attr('transform', `translate(0,${h})`)
    .call(d3.axisBottom(x).ticks(4).tickFormat(d => ['','Low','','Med','','High'][d] || '')).select('.domain').remove();
  g.append('g').attr('class', 'axis')
    .call(d3.axisLeft(y).ticks(4).tickFormat(d => ['','Low','','Med','','Critical'][d] || '')).select('.domain').remove();

  // Axis labels
  g.append('text')
    .attr('x', w / 2).attr('y', h + 40)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', 'var(--text-muted)')
    .text('Probability');
  g.append('text')
    .attr('x', -h / 2).attr('y', -45)
    .attr('text-anchor', 'middle')
    .attr('font-family', 'var(--font-mono)').attr('font-size', '11px')
    .attr('fill', 'var(--text-muted)')
    .attr('transform', 'rotate(-90)')
    .text('Severity');

  // Risk dots
  const dots = g.selectAll('.risk-dot').data(data).enter().append('g')
    .attr('transform', d => `translate(${x(d.probability)}, ${y(d.severity)})`)
    .attr('opacity', 0).attr('cursor', 'pointer');

  dots.append('circle')
    .attr('r', 10)
    .attr('fill', d => d.color + '30')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 2);

  // Labels
  dots.append('text')
    .attr('x', 16).attr('dy', '0.35em')
    .attr('font-size', '11px')
    .attr('fill', d => d.color)
    .attr('font-weight', '500')
    .text(d => d.name);

  // Animate
  gsap.to(dots.nodes(), { opacity: 1, duration: 0.4, stagger: 0.12, ease: 'power2.out' });

  // Tooltips
  dots.on('mousemove', function(e) {
    const d = d3.select(this).datum();
    showTooltip(e, `
      <div class="tt-label">Risk Factor</div>
      <div class="tt-value" style="color:${d.color}">${d.name}</div>
      <div class="tt-detail">${d.desc}</div>
    `);
  }).on('mouseleave', hideTooltip);
}

// ── ScrollTrigger: Section 6 ──
ScrollTrigger.create({ trigger: '#chart-orbits', start: 'top 80%', onEnter: buildOrbitalChart, once: true });
ScrollTrigger.create({ trigger: '#chart-comps', start: 'top 80%', onEnter: buildCompsChart, once: true });
ScrollTrigger.create({ trigger: '#chart-risks', start: 'top 80%', onEnter: buildRiskChart, once: true });

// ───── INITIALIZATION ─────
document.addEventListener('DOMContentLoaded', () => {
  console.log('RKLB Flight Profile — initialized');
});
</script>
</body>
</html>
